<?xml version="1.0" encoding="utf-8"?>
<modification>
	<name><![CDATA[<font color="#263238"><b>Materialize Theme</b></font>]]></name>
	<code>materialize-theme</code>
	<version>0.81</version>
	<author><![CDATA[<font color="#263238"><b>Trydalcoholic</b></font>]]></author>
	<link>//goo.gl/pSwwUR</link>
	<!-- List of goods cards -->
	<file path="catalog/model/catalog/product.php">
		<operation error="log">
			<search><![CDATA[$query->row['rating']]]></search>
			<add position="replace"><![CDATA[$query->row['rating'], 1]]></add>
		</operation>
	</file>
	<file path="catalog/controller/product/{category,manufacturer,product,search,special}.php">
		<operation error="log">
			<search><![CDATA[$rating = (int)$result['rating'];]]></search>
			<add position="after"><![CDATA[$reviews = (int)$result['reviews'];]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$rating = false;]]></search>
			<add position="after"><![CDATA[$reviews = false;]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$data['products'][] = array(]]></search>
			<add position="before"><![CDATA[
			if ($result['image']) {
				$hor_image = $this->model_tool_image->resize($result['image'], 80, 80);
			} else {
				$hor_image = $this->model_tool_image->resize('placeholder.png', 80, 80);
			}
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$data['products'][] = array(]]></search>
			<add position="after"><![CDATA[
			'reviews'	=> $reviews,
			'hor_image'	=> $hor_image,
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/extension/module/{bestseller,latest,special}*.php">
		<operation error="log">
			<search><![CDATA[$rating = $result['rating'];]]></search>
			<add position="after"><![CDATA[$reviews = (int)$result['reviews'];]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$rating = false;]]></search>
			<add position="after"><![CDATA[$reviews = false;]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$data['products'][] = array(]]></search>
			<add position="after"><![CDATA['reviews'	=> $reviews,]]></add>
		</operation>
	</file>
	<file path="catalog/controller/extension/module/featured.php">
		<operation error="log">
			<search><![CDATA[$rating = $product_info['rating'];]]></search>
			<add position="after"><![CDATA[$reviews = (int)$product_info['reviews'];]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$rating = false;]]></search>
			<add position="after"><![CDATA[$reviews = false;]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$data['products'][] = array(]]></search>
			<add position="after"><![CDATA['reviews'	=> $reviews,]]></add>
		</operation>
	</file>
	<!-- Progressbar -->
	<file path="admin/controller/catalog/product.php">
		<operation>
			<search><![CDATA[protected function getForm() {]]></search>
			<add position="after"><![CDATA[
			if (isset($this->request->post['progressbar'])) {
				$data['progressbar'] = $this->request->post['progressbar'];
			} elseif (!empty($product_info)) {
				$data['progressbar'] = $product_info['progressbar'];
			} else {
				$data['progressbar'] = '';
			}
			]]></add>
		</operation>
	</file>
	<file path="admin/model/catalog/product.php">
		<operation>
			<search><![CDATA[$product_id = $this->db->getLastId();]]></search>
			<add position="after"><![CDATA[
			if (isset($data['progressbar'])) {
				$this->db->query("UPDATE " . DB_PREFIX . "product SET progressbar = '" . (int)$data['progressbar'] . "' WHERE product_id = '" . (int)$product_id . "'");
			}
			]]></add>
		</operation>
		<operation>
			<search><![CDATA[public function editProduct($product_id, $data) {]]></search>
			<add position="after"><![CDATA[
			if (isset($data['progressbar'])) {
				$this->db->query("UPDATE " . DB_PREFIX . "product SET progressbar = '" . (int)$data['progressbar'] . "' WHERE product_id = '" . (int)$product_id . "'");
			}
			]]></add>
		</operation>
	</file>
	<file path="admin/view/template/catalog/product_form.twig">
		<operation>
			<search><![CDATA[<div class="tab-pane" id="tab-data">]]></search>
			<add position="after"><![CDATA[
			<div class="form-group">
				<label class="col-sm-2 control-label" for="input-progressbar"><span data-toggle="tooltip" title="progressbar">progressbar</span></label>
				<div class="col-sm-10">
					<input type="text" name="progressbar" value="{{ progressbar }}" placeholder="progressbar" id="input-progressbar" class="form-control" />
				</div>
			</div>
			]]></add>
		</operation>
	</file>
	<file path="catalog/model/catalog/product.php">
		<operation>
			<search><![CDATA[return array(]]></search>
			<add position="after"><![CDATA['progressbar'	=> $query->row['progressbar'],]]></add>
		</operation>
	</file>
	<!-- SVG Support -->
	<file path="admin/view/template/catalog/category_form.twig">
		<operation>
			<search><![CDATA[{{ footer }}]]></search>
			<add position="before"><![CDATA[<style>#thumb-image{min-width:100px;}</style>]]></add>
		</operation>
	</file>
	<file path="admin/controller/common/filemanager.php">
		<operation>
			<search><![CDATA[$files = glob($directory . '/' . $filter_name . '*.{jpg,jpeg,png,gif,JPG,JPEG,PNG,GIF}', GLOB_BRACE);]]></search>
			<add position="replace"><![CDATA[$files = glob($directory . '/' . $filter_name . '*.{jpg,jpeg,png,gif,svg,JPG,JPEG,PNG,GIF,SVG}', GLOB_BRACE);]]></add>
		</operation>
		<operation>
			<search index="0"><![CDATA[$allowed = array(]]></search>
			<add position="after"><![CDATA['svg',]]></add>
		</operation>
		<operation>
			<search index="1"><![CDATA[$allowed = array(]]></search>
			<add position="after"><![CDATA['image/svg+xml',]]></add>
		</operation>
	</file>
	<file path="admin/model/tool/image.php">
		<operation>
			<search><![CDATA[$extension = pathinfo($filename, PATHINFO_EXTENSION);]]></search>
			<add position="after"><![CDATA[
			if ($extension == 'svg') {
				if ($this->request->server['HTTPS']) {
					return HTTPS_CATALOG . 'image/' . $filename;
				} else {
					return HTTP_CATALOG . 'image/' . $filename;
				}
			}
			]]></add>
		</operation>
	</file>
	<file path="catalog/model/tool/image.php">
		<operation>
			<search><![CDATA[$extension = pathinfo($filename, PATHINFO_EXTENSION);]]></search>
			<add position="after"><![CDATA[
			if ($extension == 'svg') {
				if ($this->request->server['HTTPS']) {
					return $this->config->get('config_ssl') . 'image/' . $filename;
				} else {
					return $this->config->get('config_url') . 'image/' . $filename;
				}
			}
			]]></add>
		</operation>
	</file>
	<!-- Information page in the top menu -->
	<file path="admin/controller/catalog/information.php">
		<operation error="log">
			<search><![CDATA[$this->response->setOutput($this->load->view('catalog/information_form', $data));]]></search>
			<add position="before"><![CDATA[
			if (isset($this->request->post['top'])) {
				$data['top'] = $this->request->post['top'];
			} elseif (!empty($information_info)) {
				$data['top'] = $information_info['top'];
			} else {
				$data['top'] = 0;
			}
			]]></add>
		</operation>
	</file>
	<file path="admin/model/catalog/information.php">
		<operation error="log">
			<search><![CDATA[bottom = '" . (isset($data['bottom']) ? (int)$data['bottom'] : 0) . "',]]></search>
			<add position="replace"><![CDATA[bottom = '" . (isset($data['bottom']) ? (int)$data['bottom'] : 0) . "', top = '" . (isset($data['top']) ? (int)$data['top'] : 0) . "',]]></add>
		</operation>
	</file>
	<file path="admin/view/template/catalog/information_form.twig">
		<operation error="log">
			<search index="3"><![CDATA[<div class="form-group">]]></search>
			<add position="before"><![CDATA[
			<div class="form-group">
				<label class="col-sm-2 control-label" for="input-top"><span data-toggle="tooltip" title="{{ help_top }}">{{ entry_top }}</span></label>
				<div class="col-sm-10">
					<div class="checkbox">
						<label>
							{% if top %}
							<input type="checkbox" name="top" value="1" checked="checked" id="input-top" />
							{% else %}
							<input type="checkbox" name="top" value="1" id="input-top" />
							{% endif %}
							&nbsp;
						</label>
					</div>
				</div>
			</div>
			]]></add>
		</operation>
	</file>
	<!-- Materialize Megamenu -->
	<file path="catalog/controller/common/header.php">
		<operation error="log">
			<search><![CDATA[$data['menu'] = $this->load->controller('common/menu');]]></search>
			<add position="replace"><![CDATA[
			if ($this->config->get('module_megamenu_status') == 1) {
				$data['menu'] = $this->load->controller('extension/module/megamenu');
			} else {
				$data['menu'] = $this->load->controller('common/menu');
			}
			]]></add>
		</operation>
	</file>
	<file path="catalog/model/catalog/manufacturer.php">
		<operation error="log">
			<search><![CDATA[class ModelCatalogManufacturer extends Model {]]></search>
			<add position="after"><![CDATA[
			public function getMegamenuManufacturersByCategoryId($category_id) {
				$manufacturers = array();

				$query = $this->db->query("SELECT DISTINCT p.manufacturer_id FROM " . DB_PREFIX . "product p LEFT JOIN " . DB_PREFIX . "product_to_category p2c ON (p.product_id = p2c.product_id) WHERE p2c.category_id = ' " . $category_id . "'");

				foreach($query->rows as $manufacturer_id){
					$manufacturers[$manufacturer_id['manufacturer_id']] = $this->getManufacturer($manufacturer_id['manufacturer_id']);
				}

				return $manufacturers;
			}
			]]></add>
		</operation>
	</file>
	<!-- 3lvl vategory -->
	<file path="catalog/controller/common/menu.php">
		<operation error="log">
			<search><![CDATA[$data['categories'] = array();]]></search>
			<add position="after"><![CDATA[
			if ($materialize) {
				if (!empty($materialize_settings['header']['third_lvl_category'])) {
					$third_lvl_category = true;
				} else {
					$third_lvl_category = false;
				}

				if (!empty($materialize_settings['optimization']['cached_categories'])) {
					$cached_categories = true;

					$data['categories'] = $this->cache->get('materialize.categories.' . (int)$this->config->get('config_language_id'));
				} else {
					$cached_categories = false;
				}

				if (!$cached_categories || empty($data['categories'])) {
					$categories_1 = $this->model_catalog_category->getCategories(0);

					foreach ($categories_1 as $category_1) {
						$filter_data = array(
							'filter_category_id'	=> $category_1['category_id'],
							'filter_sub_category'	=> true
						);

						$level_2_data = array();

						$categories_2 = $this->model_catalog_category->getCategories($category_1['category_id']);

						foreach ($categories_2 as $category_2) {
							$filter_data = array(
								'filter_category_id'	=> $category_2['category_id'],
								'filter_sub_category'	=> true
							);

							$level_3_data = array();

							if ($third_lvl_category) {
								$categories_3 = $this->model_catalog_category->getCategories($category_2['category_id']);

								foreach ($categories_3 as $category_3) {
									$filter_data = array(
										'filter_category_id'	=> $category_3['category_id'],
										'filter_sub_category'	=> true
									);

									$level_3_data[] = array(
										'name'	=> ($this->config->get('config_product_count') ? '<span class="new-badge" data-badge="' . $this->model_catalog_product->getTotalProducts($filter_data) . '">' . $category_3['name'] . '</span>' : $category_3['name']),
										'href'	=> $this->url->link('product/category', 'path=' . $category_3['category_id'])
									);
								}
							}

							$level_2_data[] = array(
								'name'		=> ($this->config->get('config_product_count') ? '<span class="new-badge" data-badge="' . $this->model_catalog_product->getTotalProducts($filter_data) . '">' . $category_2['name'] . '</span>' : $category_2['name']),
								'href'		=> $this->url->link('product/category', 'path=' . $category_2['category_id']),
								'children'	=> $level_3_data
							);
						}

						$data['categories'][] = array(
							'name'		=> $category_1['name'],
							'href'		=> $this->url->link('product/category', 'path=' . $category_1['category_id']),
							'children'	=> $level_2_data
						);
					}

					if ($cached_categories) {
						$this->cache->set('materialize.categories.' . (int)$this->config->get('config_language_id'), $data['categories']);
					}
				}
			} else {
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[return $this->load->view('common/menu', $data);]]></search>
			<add position="before"><![CDATA[}]]></add>
		</operation>
	</file>
	<!-- Materialize Permissions -->
	<file path="admin/controller/user/user_permission.php">
		<operation error="log">
			<search><![CDATA[$data['permissions'] = array();]]></search>
			<add position="after"><![CDATA[$data['permissions'] = array('extension/materialize');]]></add>
		</operation>
	</file>
	<!-- Metadata -->
	<file path="catalog/controller/common/header.php">
		<operation error="log">
			<search><![CDATA[public function index() {]]></search>
			<add position="after"><![CDATA[
			$this->load->model('tool/image');

			$facebook_share_image_width = 600;
			$facebook_share_image_height = 315;

			if($this->document->getImage()){
				$facebook_share_image = $this->model_tool_image->resize($this->document->getImage(), $facebook_share_image_width, $facebook_share_image_height);
			} else {
				$facebook_share_image = $this->model_tool_image->resize($this->config->get('config_logo'), $facebook_share_image_width, $facebook_share_image_height);
			}

			$data['facebook_site_name'] = $this->config->get('config_name');
			$data['facebook_share_url'] = ($this->request->server['HTTPS'] ? 'https://' : 'http://') . $this->request->server['HTTP_HOST'] . $this->request->server['REQUEST_URI'];
			$data['facebook_share_type'] = ($this->document->getType()) ? $this->document->getType() : 'website';
			$data['facebook_share_title'] = $this->document->getTitle();
			$data['facebook_share_description'] = $this->document->getDescription();
			$data['facebook_share_image'] = $facebook_share_image;
			$data['facebook_share_image_width'] = $facebook_share_image_width;
			$data['facebook_share_image_height'] = $facebook_share_image_height;
			$data['facebook_product_price_amount'] = $this->document->getPrice();
			$data['facebook_product_price_currency'] = $this->config->get('config_currency');
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/product/category.php">
		<operation error="log">
			<search><![CDATA[if ($category_info) {]]></search>
			<add position="after"><![CDATA[
			$this->document->setImage($category_info['image']);

			if($category_info['image']){
				$share_image = $this->model_tool_image->resize($category_info['image'], 600, 315);
			} else {
				$share_image = $this->model_tool_image->resize($this->config->get('config_image'), 600, 315);
			}

			$this->document->setImage($share_image);
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/product/manufacturer.php">
		<operation error="log">
			<search><![CDATA[if ($manufacturer_info) {]]></search>
			<add position="after"><![CDATA[$this->document->setImage($manufacturer_info['image']);]]></add>
		</operation>
	</file>
	<file path="catalog/controller/product/product.php">
		<operation error="log">
			<search><![CDATA[if ($product_info) {]]></search>
			<add position="after"><![CDATA[
			$this->document->setType('product');
			$this->document->setImage($product_info['image']);
			$this->document->setPrice($this->tax->calculate($product_info['price'], $product_info['tax_class_id'], $this->config->get('config_tax')));
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$this->load->model('tool/image');]]></search>
			<add position="after"><![CDATA[
			if($product_info['image']){
				$share_image = $this->model_tool_image->resize($product_info['image'], 600, 315);
			} else {
				$share_image = $this->model_tool_image->resize($this->config->get('config_image'), 600, 315);
			}

			$this->document->setImage($share_image);
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$data['price'] = $this->currency->format($this->tax->calculate($product_info['price'], $product_info['tax_class_id'], $this->config->get('config_tax')), $this->session->data['currency']);]]></search>
			<add position="after"><![CDATA[$data['meta_price'] = $product_info['price'];]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$data['special'] = $this->currency->format($this->tax->calculate($product_info['special'], $product_info['tax_class_id'], $this->config->get('config_tax')), $this->session->data['currency']);]]></search>
			<add position="after"><![CDATA[$data['meta_special'] = $product_info['special'];]]></add>
		</operation>
	</file>
	<file path="system/library/document.php">
		<operation error="log">
			<search><![CDATA[class Document {]]></search>
			<add position="after"><![CDATA[
			private $image;
			private $url;
			private $type;
			private $price;
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[private $scripts = array();]]></search>
			<add position="after"><![CDATA[
			public function setImage($image) {
				$this->image = $image;
			}

			public function getImage() {
				return $this->image;
			}

			public function setUrl($url) {
				$this->url = $url;
			}

			public function getUrl() {
				return $this->url;
			}

			public function setType($type) {
				$this->type = $type;
			}

			public function getType() {
				return $this->type;
			}

			public function setPrice($price) {
				$this->price = $price;
			}

			public function getPrice() {
				return $this->price;
			}
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/common/home.php">
		<operation error="log">
			<search><![CDATA[public function index() {]]></search>
			<add position="after"><![CDATA[
			if ($this->request->server['HTTPS']) {
				$server = $this->config->get('config_ssl');
			} else {
				$server = $this->config->get('config_url');
			}

			$data['base'] = $server;
			]]></add>
		</operation>
	</file>
	<!-- Slider images on the product card -->
	<file path="catalog/controller/product/product.php">
		<operation error="log">
			<search index="0"><![CDATA[if ($product_info['image']) {]]></search>
			<add position="before"><![CDATA[if (!$materialize) {]]></add>
		</operation>
		<operation error="log">
			<search index="0"><![CDATA[if ($this->customer->isLogged() || !$this->config->get('config_customer_price')) {]]></search>
			<add position="before"><![CDATA[
			} else {
				$data['images'] = array();

				$data['data_size'] = $this->config->get('theme_' . $this->config->get('config_theme') . '_image_popup_width').'x'.$this->config->get('theme_' . $this->config->get('config_theme') . '_image_popup_height');

				if ($product_info['image']) {
					$data['images'][] = array(
						'popup' => $this->model_tool_image->resize($product_info['image'], $this->config->get('theme_' . $this->config->get('config_theme') . '_image_popup_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_popup_height')),
						'preview' => $this->model_tool_image->resize($product_info['image'], $this->config->get('theme_' . $this->config->get('config_theme') . '_image_thumb_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_thumb_height')),
						'thumb' => $this->model_tool_image->resize($product_info['image'], $this->config->get('theme_' . $this->config->get('config_theme') . '_image_additional_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_additional_height')),
						'zoom_id' => 0
					);
					$data['product_image'] = true;
				} else {
					$data['placeholder'] = $this->model_tool_image->resize('no_image.png', $this->config->get('theme_' . $this->config->get('config_theme') . '_image_thumb_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_thumb_height'));
					$data['product_image'] = false;
				}

				$results = $this->model_catalog_product->getProductImages($this->request->get['product_id']);

				foreach ($results as $result) {
					$data['images'][] = array(
						'popup' => $this->model_tool_image->resize($result['image'], $this->config->get('theme_' . $this->config->get('config_theme') . '_image_popup_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_popup_height')),
						'preview' => $this->model_tool_image->resize($result['image'], $this->config->get('theme_' . $this->config->get('config_theme') . '_image_thumb_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_thumb_height')),
						'thumb' => $this->model_tool_image->resize($result['image'], $this->config->get('theme_' . $this->config->get('config_theme') . '_image_additional_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_additional_height')),
						'zoom_id' => $result['product_image_id']
					);
				}

				if (count($data['images']) > 1) {
					$data['thumb_images'] = true;
				} else {
					$data['thumb_images'] = false;
				}

				$image_info = $this->config->get('theme_materialize_products');

				if (isset($image_info['imagezoom'])) {
					$this->document->addScript('catalog/view/theme/materialize/js/imagezoom/imagezoom.min.js');
					$data['image_zoom'] = true;
				} else {
					$data['image_zoom'] = false;
				}

				$data['photoswipe'] = $this->load->controller('extension/module/photoswipe', $data);
			}
			]]></add>
		</operation>
	</file>
	<!-- Canceling a remote product -->
	<file path="catalog/controller/common/cart.php">
		<operation error="log">
			<search><![CDATA[$data['products'][] = array(]]></search>
			<add position="after"><![CDATA['product_id'	=> $product['product_id'],]]></add>
		</operation>
	</file>
	<!-- Materialize Pagination -->
	<file path="catalog/controller/{account,product}/{download,order,recurring,return,reward,transaction,category,manufacturer,product,search,special}*.php">
		<operation error="log">
			<search><![CDATA[new Pagination();]]></search>
			<add position="replace"><![CDATA[new MaterializePagination();]]></add>
		</operation>
	</file>
	<!-- Labels -->
	<file path="admin/controller/catalog/product.php">
		<operation error="log">
			<search><![CDATA[$this->load->model('setting/store');]]></search>
			<add position="before"><![CDATA[
			if ($this->config->get('module_label_status') == 1) {
				$data['module_label'] = true;

				$this->load->model('extension/materialize/label');

				$data['labels'] = array();

				$labels = $this->model_extension_materialize_label->getLabels();

				foreach ($labels as $label) {
					$data['labels'][] = array(
						'label_id'	=> $label['label_id'],
						'name'		=> $label['name']
					);
				}

				if (isset($this->request->post['product_label'])) {
					$data['product_label'] = $this->request->post['product_label'];
				} elseif (isset($this->request->get['product_id'])) {
					$data['product_label'] = $this->model_catalog_product->getProductLabels($this->request->get['product_id']);
				} else {
					$data['product_label'] = array();
				}
			} else {
				$data['module_label'] = false;
			}
			]]></add>
		</operation>
	</file>
	<file path="admin/model/catalog/product.php">
		<operation error="log">
			<search><![CDATA[$product_id = $this->db->getLastId();]]></search>
			<add position="after"><![CDATA[
			if ($this->config->get('module_label_status') == 1) {
				if (isset($data['product_label'])) {
					foreach ($data['product_label'] as $label_id) {
						$this->db->query("INSERT INTO " . DB_PREFIX . "product_label SET product_id = '" . (int)$product_id . "', label_id = '" . (int)$label_id . "'");
					}
				}
			}
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[public function editProduct($product_id, $data) {]]></search>
			<add position="after"><![CDATA[
			if ($this->config->get('module_label_status') == 1) {
				$this->db->query("DELETE FROM " . DB_PREFIX . "product_label WHERE product_id = '" . (int)$product_id . "'");

				if (isset($data['product_label'])) {
					foreach ($data['product_label'] as $product_label) {
						$this->db->query("INSERT INTO " . DB_PREFIX . "product_label SET product_id = '" . (int)$product_id . "', label_id = '" . (int)$product_label . "'");
					}
				}
			}
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$this->addProduct($data);]]></search>
			<add position="before"><![CDATA[
			if ($this->config->get('module_label_status') == 1) {
				$data['product_label'] = $this->getProductLabels($product_id);
			}
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[public function deleteProduct($product_id) {]]></search>
			<add position="after"><![CDATA[
			if ($this->config->get('module_label_status') == 1) {
				$this->db->query("DELETE FROM " . DB_PREFIX . "product_label WHERE product_id = '" . (int)$product_id . "'");
			}
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[class ModelCatalogProduct extends Model {]]></search>
			<add position="after"><![CDATA[
			public function getProductLabels($product_id) {
				$product_label_data = array();

				$query = $this->db->query("SELECT * FROM " . DB_PREFIX . "product_label WHERE product_id = '" . (int)$product_id . "'");

				foreach ($query->rows as $result) {
					$product_label_data[] = $result['label_id'];
				}

				return $product_label_data;
			}

			public function getTotalProductsByLabelId($label_id) {
				$query = $this->db->query("SELECT COUNT(*) AS total FROM " . DB_PREFIX . "product_label WHERE label_id = '" . (int)$label_id . "'");

				return $query->row['total'];
			}
			]]></add>
		</operation>
	</file>
	<file path="admin/view/template/catalog/product_form.twig">
		<operation error="log">
			<search><![CDATA[<div class="tab-pane" id="tab-links">]]></search>
			<add position="after"><![CDATA[
			{% if module_label %}
				<div class="form-group">
					<label class="col-sm-2 control-label">{{ text_labels }}</label>
					<div class="col-sm-10">
						<div class="well well-sm" style="height: 150px; overflow: auto;">
							{% for label in labels %}
							<div class="checkbox">
								<label>
									{% if label.label_id in product_label %}
									<input type="checkbox" name="product_label[]" value="{{ label.label_id }}" checked="checked" />
									{{ label.name }}
									{% else %}
									<input type="checkbox" name="product_label[]" value="{{ label.label_id }}" />
									{{ label.name }}
									{% endif %}
								</label>
							</div>
							{% endfor %}
						</div>
					</div>
				</div>
			{% endif %}
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/product/{category,manufacturer,product,search,special}*.php">
		<operation error="log">
			<search><![CDATA[$data['products'][] = array(]]></search>
			<add position="before"><![CDATA[
			$labels = array();

			if ($this->config->get('module_label_status') == 1) {
				$labels_array = $this->model_catalog_product->getProductLabels($result['product_id']);

				foreach ($labels_array as $label) {
					$labels[] = array(
						'name'			=> $label['name'],
						'color'			=> $label['label_color'],
						'color_text'	=> $label['label_color_text']
					);
				}
			}
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$data['products'][] = array(]]></search>
			<add position="after"><![CDATA['labels'	=> $labels,]]></add>
		</operation>
	</file>
	<file path="catalog/controller/product/product.php">
		<operation error="log">
			<search><![CDATA[if ($product_info) {]]></search>
			<add position="after"><![CDATA[
			$data['labels'] = array();

			if ($this->config->get('module_label_status') == 1) {
				$results = $this->model_catalog_product->getProductLabels($this->request->get['product_id']);

				foreach ($results as $result) {
					$data['labels'][] = array(
						'name'			=> $result['name'],
						'color'			=> $result['label_color'],
						'color_text'	=> $result['label_color_text']
					);
				}
			}
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/extension/module/featured.php">
		<operation error="log">
			<search><![CDATA[$data['products'][] = array(]]></search>
			<add position="before"><![CDATA[
			$labels = array();

			if ($this->config->get('module_label_status') == 1) {
				$results = $this->model_catalog_product->getProductLabels($product_info['product_id']);

				foreach ($results as $result) {
					$labels[] = array(
						'name'			=> $result['name'],
						'color'			=> $result['label_color'],
						'color_text'	=> $result['label_color_text']
					);
				}
			}
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$data['products'][] = array(]]></search>
			<add position="after"><![CDATA['labels'	=> $labels,]]></add>
		</operation>
	</file>
	<file path="catalog/controller/extension/module/{bestseller,latest,special}*.php">
		<operation error="log">
			<search><![CDATA[$data['products'][] = array(]]></search>
			<add position="before"><![CDATA[
			$labels = array();

			if ($this->config->get('module_label_status') == 1) {
				$labels_array = $this->model_catalog_product->getProductLabels($result['product_id']);

				foreach ($labels_array as $label) {
					$labels[] = array(
						'name'			=> $label['name'],
						'color'			=> $label['label_color'],
						'color_text'	=> $label['label_color_text']
					);
				}
			}
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$data['products'][] = array(]]></search>
			<add position="after"><![CDATA['labels'	=> $labels,]]></add>
		</operation>
	</file>
	<file path="catalog/model/catalog/product.php">
		<operation error="log">
			<search><![CDATA[class ModelCatalogProduct extends Model {]]></search>
			<add position="after"><![CDATA[
			public function getProductLabels($product_id) {
				$query = $this->db->query("SELECT * FROM " . DB_PREFIX . "product_label pl LEFT JOIN " . DB_PREFIX . "materialize_label_description mld ON (pl.label_id = mld.label_id) LEFT JOIN " . DB_PREFIX . "materialize_label ml ON (pl.label_id = ml.label_id) WHERE pl.product_id = '" . (int)$product_id . "' AND mld.language_id = '" . (int)$this->config->get('config_language_id') . "' ORDER BY sort_order ASC");

				return $query->rows;
			}
			]]></add>
		</operation>
	</file>
	<!-- Size Chart -->
	<file path="admin/controller/catalog/product.php">
		<operation error="log">
			<search><![CDATA[protected function getForm() {]]></search>
			<add position="after"><![CDATA[
			if ($this->config->get('module_sizechart_status') == 1) {
				$data['module_sizechart'] = true;

				$this->load->model('extension/materialize/sizechart');

				if (isset($this->request->post['sizechart_id'])) {
					$data['sizechart_id'] = $this->request->post['sizechart_id'];
				} elseif (isset($this->request->get['product_id'])) {
					$data['sizechart_id'] = $this->model_catalog_product->getProductSizecharts($this->request->get['product_id']);
				} else {
					$data['sizechart_id'] = 0;
				}

				$data['product_sizechart'] = array();

				$sizechart_info = $this->model_extension_materialize_sizechart->getSizechart($data['sizechart_id']);

				if ($sizechart_info) {
					$data['product_sizechart'][] = array(
						'sizechart_id'	=> $sizechart_info['sizechart_id'],
						'name'			=> $sizechart_info['group'] . ' &gt; ' . $sizechart_info['name']
					);
				}
			} else {
				$data['module_sizechart'] = false;
			}
			]]></add>
		</operation>
	</file>
	<file path="admin/model/catalog/product.php">
		<operation error="log">
			<search><![CDATA[class ModelCatalogProduct extends Model {]]></search>
			<add position="after"><![CDATA[
			public function getProductSizecharts($product_id) {
				$sizechart_id = array();

				$query = $this->db->query("SELECT * FROM " . DB_PREFIX . "product_materialize_sizechart WHERE product_id = '" . (int)$product_id . "'");

				foreach ($query->rows as $result) {
					$sizechart_id = $result['sizechart_id'];
				}

				return $sizechart_id;
			}
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$product_id = $this->db->getLastId();]]></search>
			<add position="after"><![CDATA[
			if (isset($data['sizechart_id'])) {
				$this->db->query("INSERT INTO " . DB_PREFIX . "product_materialize_sizechart SET product_id = '" . (int)$product_id . "', sizechart_id = '" . (int)$data['sizechart_id'] . "'");
			}
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[public function editProduct($product_id, $data) {]]></search>
			<add position="after"><![CDATA[
			if ($this->config->get('module_sizechart_status') == 1) {
				$this->db->query("DELETE FROM " . DB_PREFIX . "product_materialize_sizechart WHERE product_id = '" . (int)$product_id . "'");

				if (isset($data['sizechart_id'])) {
					$this->db->query("INSERT INTO " . DB_PREFIX . "product_materialize_sizechart SET product_id = '" . (int)$product_id . "', sizechart_id = '" . (int)$data['sizechart_id'] . "'");
				}
			}
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[public function deleteProduct($product_id) {]]></search>
			<add position="after"><![CDATA[
			if ($this->config->get('module_sizechart_status') == 1) {
				$this->db->query("DELETE FROM " . DB_PREFIX . "product_materialize_sizechart WHERE product_id = '" . (int)$product_id . "'");
			}
			]]></add>
		</operation>
	</file>
	<file path="admin/view/template/catalog/product_form.twig">
		<operation error="log">
			<search><![CDATA[<div class="tab-pane" id="tab-links">]]></search>
			<add position="after"><![CDATA[
			{% if module_sizechart %}
				<div class="form-group">
					<label class="col-sm-2 control-label" for="input-sizechart">{{ text_sizechart }}</label>
					<div class="col-sm-10">
						{% if product_sizechart %}
						{% for sizechart in product_sizechart %}
						<input type="text" name="sizechart" value="{{ sizechart.name }}" placeholder="{{ text_sizechart }}" id="input-sizechart" class="form-control" />
						<input type="hidden" name="sizechart_id" value="{{ sizechart.sizechart_id }}" />
						{% endfor %}
						{% else %}
						<input type="text" name="sizechart" value="" placeholder="{{ text_sizechart }}" id="input-sizechart" class="form-control" />
						<input type="hidden" name="sizechart_id" value="" />
						{% endif %}
					</div>
				</div>
			{% endif %}
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[{{ footer }}]]></search>
			<add position="before"><![CDATA[
			{% if module_sizechart %}
			<script type="text/javascript">
				$('input[name=\'sizechart\']').autocomplete({
					'source': function(request, response) {
						$.ajax({
							url: 'index.php?route=extension/materialize/sizechart/sizechart/autocomplete&user_token={{ user_token }}&filter_name=' +  encodeURIComponent(request),
							dataType: 'json',
							success: function(json) {
								response($.map(json, function(item) {
									return {
										label: item['name'],
										value: item['sizechart_id']
									}
								}));
							}
						});
					},
					'select': function(item) {
						$('input[name=\'sizechart\']').val(item['label']);
						$('input[name=\'sizechart_id\']').val(item['value']);
					}
				});
			</script>
			{% endif %}
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/product/product.php">
		<operation error="log">
			<search><![CDATA[if ($product_info) {]]></search>
			<add position="after"><![CDATA[
			if ($this->config->get('module_sizechart_status') == 1) {
				$data['sizechart'] = $this->load->controller('extension/module/sizechart', $data);
			} else {
				$data['sizechart'] = false;
			}
			]]></add>
		</operation>
	</file>
	<!-- Callback -->
	<file path="catalog/controller/common/header.php">
		<operation error="log">
			<search><![CDATA[public function index() {]]></search>
			<add position="after"><![CDATA[
			if ($this->config->get('module_callback_status') == 1) {
				$module_callback = $this->config->get('module_callback');

				$data['callback_status'] = true;
				$data['callback_title'] = $module_callback[$this->config->get('config_language_id')]['title'];
				$data['callback_module'] = $this->load->controller('extension/module/callback', $data);
			} else {
				$data['callback_status'] = false;
				$data['callback_module'] = '';
			}
			]]></add>
		</operation>
	</file>
	<!-- Disable standard scripts -->
	<file path="catalog/controller/extension/module/banner.php">
		<operation error="log">
			<search><![CDATA[$this->document->addStyle('catalog/view/javascript/jquery/swiper/css/swiper.min.css');]]></search>
			<add position="before"><![CDATA[if (!$materialize) {]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$this->document->addScript('catalog/view/javascript/jquery/swiper/js/swiper.jquery.js');]]></search>
			<add position="after"><![CDATA[
			} else {
				$this->document->addScript('catalog/view/theme/materialize/js/slick-carousel/slick.min.js');

				$this->document->addStyle('catalog/view/theme/materialize/stylesheet/slick-carousel/slick.css');
				$this->document->addStyle('catalog/view/theme/materialize/stylesheet/slick-carousel/slick-theme.css');
			}
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/extension/module/carousel.php">
		<operation error="log">
			<search><![CDATA[$this->document->addStyle('catalog/view/javascript/jquery/swiper/css/swiper.min.css');]]></search>
			<add position="before"><![CDATA[if (!$materialize) {]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$this->document->addScript('catalog/view/javascript/jquery/swiper/js/swiper.jquery.js');]]></search>
			<add position="after"><![CDATA[
			} else {
				$this->document->addScript('catalog/view/theme/materialize/js/slick-carousel/slick.min.js');

				$this->document->addStyle('catalog/view/theme/materialize/stylesheet/slick-carousel/slick.css');
				$this->document->addStyle('catalog/view/theme/materialize/stylesheet/slick-carousel/slick-theme.css');
			}
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/extension/module/slideshow.php">
		<operation error="log">
			<search><![CDATA[$this->document->addStyle('catalog/view/javascript/jquery/swiper/css/swiper.min.css');]]></search>
			<add position="before"><![CDATA[if (!$materialize) {]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$this->document->addScript('catalog/view/javascript/jquery/swiper/js/swiper.jquery.js');]]></search>
			<add position="after"><![CDATA[
			} else {
				$this->document->addScript('catalog/view/theme/materialize/js/slick-carousel/slick.min.js');

				$this->document->addStyle('catalog/view/theme/materialize/stylesheet/slick-carousel/slick.css');
				$this->document->addStyle('catalog/view/theme/materialize/stylesheet/slick-carousel/slick-theme.css');
			}
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/product/product.php">
		<operation error="log">
			<search><![CDATA[$this->document->addScript('catalog/view/javascript/jquery/magnific/jquery.magnific-popup.min.js');]]></search>
			<add position="before"><![CDATA[if (!$materialize) {]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$this->document->addStyle('catalog/view/javascript/jquery/datetimepicker/bootstrap-datetimepicker.min.css');]]></search>
			<add position="after"><![CDATA[
			} else {
				$this->document->addScript('catalog/view/theme/materialize/js/slick-carousel/slick.min.js');

				$this->document->addStyle('catalog/view/theme/materialize/stylesheet/slick-carousel/slick.css');
				$this->document->addStyle('catalog/view/theme/materialize/stylesheet/slick-carousel/slick-theme.css');
			}
			]]></add>
		</operation>
	</file>
	<!-- Enable Materialize scripts -->
	<file path="catalog/controller/common/header.php">
		<operation error="log">
			<search><![CDATA[public function index() {]]></search>
			<add position="after"><![CDATA[
			if ($materialize) {
				$this->document->addStyle('catalog/view/theme/materialize/stylesheet/materialize/materialize.min.css');
				$this->document->addStyle('catalog/view/theme/materialize/stylesheet/material-design-icons/material-icons.css');
				$this->document->addStyle('catalog/view/theme/materialize/stylesheet/style.css');
			}
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$data['styles'] = $this->document->getStyles();]]></search>
			<add position="replace"><![CDATA[
			$styles = $this->document->getStyles();

			$css = "";

			foreach ($styles as $style) {
				$css .= file_get_contents($style['href']);
			}

			$css = preg_replace('!/\*[^*]*\*+([^/][^*]*\*+)*/!', '', $css);

			$css = str_replace(': ', ':', $css);

			$css = str_replace(array("\r\n", "\r", "\n", "\t", '  ', '    ', '    '), '', $css);

			$data['css'] = $css;
			]]></add>
		</operation>
	</file>
	<!-- Materialize Template Settings frontend -->
	<file path="catalog/controller/common/header.php">
		<operation error="log">
			<search><![CDATA[return $this->load->view('common/header', $data);]]></search>
			<add position="before"><![CDATA[
			if ($materialize) {
				$this->load->model('tool/image');

				if (isset($materialize_settings['social'])) {
					$materialize_social = $materialize_settings['social'];
				} else {
					$materialize_social = '';
				}

				if (isset($materialize_social['meta_data'])) {
					$this->load->model('extension/materialize/materialize');

					$data['social_links'] = $this->model_extension_materialize_materialize->getSocialLinks();
				} else {
					$data['social_links'] = false;
				}

				if (isset($materialize_settings['favicon'])) {
					$materialize_favicon = $materialize_settings['favicon'];
				} else {
					$materialize_favicon = '';
				}

				if (!empty($materialize_favicon['status'])) {
					if (!empty($materialize_favicon['image'])) {
						$favicon_image = $materialize_settings['favicon']['image'];

						$icon = (DIR_IMAGE . $favicon_image);
						$info = getimagesize($icon);
						$icon_type = isset($info['mime']) ? $info['mime'] : '';

						$data['favicon_images'][] = array(
							'rel'	=> 'icon',
							'type'	=> $icon_type,
							'sizes'	=> '16x16',
							'href'	=> $this->model_tool_image->resize($materialize_favicon['image'], 16, 16)
						);

						$data['favicon_images'][] = array(
							'rel'	=> 'icon',
							'type'	=> $icon_type,
							'sizes'	=> '32x32',
							'href'	=> $this->model_tool_image->resize($materialize_favicon['image'], 32, 32)
						);

						$data['favicon_images'][] = array(
							'rel'	=> 'apple-touch-icon',
							'type'	=> $icon_type,
							'sizes'	=> '180x180',
							'href'	=> $this->model_tool_image->resize($materialize_favicon['image'], 180, 180)
						);
					}

					if (!empty($materialize_favicon['svg'])) {
						$data['favicon_images'][] = array(
							'rel'	=> 'icon',
							'type'	=> 'image/svg+xml',
							'sizes'	=> 'any',
							'href'	=> $server . 'image/' . $materialize_favicon['svg']
						);

						$data['favicon_mask_icons'][] = array(
							'rel'	=> 'mask-icon',
							'href'	=> $server . 'image/' . $materialize_favicon['svg'],
							'color'	=> '#' . $materialize_favicon['maskiconcolor']
						);
					}
				}

				if (isset($materialize_favicon['browserconfig']['status'])) {
					$data['browserconfig'] = $server . "catalog/view/theme/materialize/js/browserconfig.xml";
					$data['color_tile_color'] = '#' . $materialize_favicon['browserconfig']['background_color']['hex'];
				} else {
					$data['browserconfig'] = false;
					$data['color_tile_color'] = false;
				}

				if (!empty($materialize_favicon['manifest']['status'])) {
					if ($materialize_favicon['manifest']['type'] == 'static') {
						$data['manifest'] = $server . "catalog/view/theme/materialize/js/manifest.json";
					} else {
						$data['manifest'] = $server . "index.php?route=extension/feed/webmanifest";
					}
				} else {
					$data['manifest'] = '';
				}

				$this->load->model('catalog/information');

				$data['informations'] = array();

				foreach ($this->model_catalog_information->getInformations() as $result) {
					if ($result['top']) {
						$data['informations'][] = array(
							'title'	=> $result['title'],
							'href'	=> $this->url->link('information/information', 'information_id=' . $result['information_id'])
						);
					}
				}

				$data['compare'] = $this->url->link('product/compare');
				$data['text_compare'] = (isset($this->session->data['compare']) ? count($this->session->data['compare']) : 0);

				if (isset($materialize_settings['header'])) {
					$materialize_header = $materialize_settings['header'];
				} else {
					$materialize_header = '';
				}

				if (isset($materialize_header['phone'])) {
					$data['telephone_status'] = true;
				} else {
					$data['telephone_status'] = false;
				}

				if (isset($materialize_header['email'])) {
					$data['email'] = $this->config->get('config_email');
				} else {
					$data['email'] = false;
				}

				if (isset($materialize_header['working_hours'])) {
					$data['open'] = nl2br($this->config->get('config_open'));
				} else {
					$data['open'] = false;
				}

				if (isset($materialize_settings['adult_content'])) {
					$materialize_adult = $materialize_settings['adult_content'];
				} else {
					$materialize_adult = '';
				}

				if (isset($materialize_adult['status'])) {
					$this->session->data['adult_content'] = true;

					if (isset($this->session->data['adult_content_accept'])) {
						$this->session->data['adult_content_accept'] = $this->session->data['adult_content_accept'];
					} else {
						$this->session->data['adult_content_accept'] = false;
					}

					$adult_info = array(
						'agreement_id'	=> $materialize_adult['agreement'],
						'back_link'		=> $materialize_adult['back_link']
					);

					$logged = $this->customer->isLogged();

					if (isset($this->session->data['adult_content']) && $this->session->data['adult_content_accept'] == false && $logged == false) {
						$data['adult_content'] = $this->load->controller('extension/module/adult_content', $adult_info);
					} else {
						$data['adult_content'] = '';
					}
				} else {
					$data['adult_content'] = '';
				}
			}
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/common/footer.php">
		<operation error="log">
			<search><![CDATA[public function index() {]]></search>
			<add position="after"><![CDATA[
			if ($materialize) {
				$materialize_footer = $materialize_settings['footer'];

				$data['footer_title'] = $materialize_footer[$this->config->get('config_language_id')]['title'];
				$data['footer_description'] = $materialize_footer[$this->config->get('config_language_id')]['description'];

				if (isset($materialize_footer['contact_information'])) {
					$data['footer_contact'] = $materialize_footer['contact_information'];
					$data['email'] = $this->config->get('config_email');
					$data['telephone'] = $this->config->get('config_telephone');
					$data['open'] = nl2br($this->config->get('config_open'));
					$data['address'] = nl2br($this->config->get('config_address'));
				} else {
					$data['footer_contact'] = '';
				}

				if (isset($materialize_settings['social'])) {
					$materialize_social = $materialize_settings['social'];
				} else {
					$materialize_social = '';
				}

				if (isset($materialize_social['show_footer'])) {
					$data['social_show'] = true;
					$data['social_title'] = $materialize_social[$this->config->get('config_language_id')]['title'];

					if (isset($materialize_social['not_index'])) {
						$data['social_not_index'] = ' nofollow';
					} else {
						$data['social_not_index'] = false;
					}

					$this->load->model('tool/image');

					$this->load->model('extension/materialize/materialize');

					$data['social_network'] = true;

					$data['social_icons'] = array();

					$results = $this->model_extension_materialize_materialize->getSocialIcons();

					foreach ($results as $result) {
						if (is_file(DIR_IMAGE . $result['icon'])) {
							$data['social_icons'][] = array(
								'title'	=> $result['title'],
								'link'	=> $result['link'],
								'icon'	=> $this->model_tool_image->resize($result['icon'], 75, 75)
							);
						}
					}
				} else {
					$data['social_show'] = false;
				}
			}
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/product/product.php">
		<operation error="log">
			<search><![CDATA[$this->load->model('tool/image');]]></search>
			<add position="after"><![CDATA[
			if ($materialize) {
				$materialize_settings_products = $this->config->get('theme_materialize_products');

				if (isset($materialize_settings_products['fields'])) {
					$materialize_fields = $materialize_settings_products['fields'];
				} else {
					$materialize_fields = '';
				}

				if (isset($materialize_fields['model'])) {
					$data['model'] = $product_info['model'];
				} else {
					$data['model'] = '';
				}

				if (isset($materialize_fields['sku'])) {
					$data['sku'] = $product_info['sku'];
				} else {
					$data['sku'] = '';
				}

				if (isset($materialize_fields['upc'])) {
					$data['upc'] = $product_info['upc'];
				} else {
					$data['upc'] = '';
				}

				if (isset($materialize_fields['ean'])) {
					$data['ean'] = $product_info['ean'];
				} else {
					$data['ean'] = '';
				}

				if (isset($materialize_fields['jan'])) {
					$data['jan'] = $product_info['jan'];
				} else {
					$data['jan'] = '';
				}

				if (isset($materialize_fields['isbn'])) {
					$data['isbn'] = $product_info['isbn'];
				} else {
					$data['isbn'] = '';
				}

				if (isset($materialize_fields['mpn'])) {
					$data['mpn'] = $product_info['mpn'];
				} else {
					$data['mpn'] = '';
				}

				if (isset($materialize_fields['location'])) {
					$data['location'] = $product_info['location'];
				} else {
					$data['location'] = '';
				}

				if (isset($materialize_fields['dimension'])) {
					$data['dimensions_length'] = $this->length->format($product_info['length'], $product_info['length_class_id']);
					$data['dimensions_width'] = $this->length->format($product_info['width'], $product_info['length_class_id']);
					$data['dimensions_height'] = $this->length->format($product_info['height'], $product_info['length_class_id']);
				} else {
					$data['dimensions_length'] = '';
					$data['dimensions_width'] = '';
					$data['dimensions_height'] = '';
				}

				if (isset($materialize_fields['weight'])) {
					$data['weight'] = $this->weight->format($product_info['weight'], $product_info['weight_class_id']);
				} else {
					$data['weight'] = '';
				}

				if ((isset($materialize_fields['progressbar'])) && ($this->config->get('config_stock_display') == 1)) {
					$progressbar = $product_info['progressbar'];

					if ($progressbar > 0) {
						$data['progressbar'] = true;

						$progressbar_percent = round(($product_info['quantity'] * 100)/$progressbar);

						$data['progressbar_percent'] = $progressbar_percent;

						if ($progressbar_percent <= 5) {
							$data['progressbar_color'] = 'red accent-4';
						} elseif (($progressbar_percent > 5) && ($progressbar_percent <= 10)) {
							$data['progressbar_color'] = 'red';
						} elseif (($progressbar_percent > 11) && ($progressbar_percent <= 30)) {
							$data['progressbar_color'] = 'yellow';
						} elseif (($progressbar_percent > 30) && ($progressbar_percent <= 70)) {
							$data['progressbar_color'] = 'green lighten-1';
						} elseif (($progressbar_percent > 70) && ($progressbar_percent <= 100)) {
							$data['progressbar_color'] = 'green';
						} elseif ($progressbar_percent > 100) {
							$data['progressbar_color'] = 'green';
							$data['progressbar_percent'] = '100';
						}
					} else {
						$data['progressbar'] = false;
					}
				} else {
					$data['progressbar'] = '';
				}

				if (isset($materialize_fields['tags'])) {
					$data['show_tags'] = true;
				} else {
					$data['show_tags'] = false;
				}

				if (isset($materialize_settings_products['payment'])) {
					$materialize_payment = $materialize_settings_products['payment'];
				} else {
					$materialize_payment = '';
				}

				if (isset($materialize_payment['image'])) {
					$data['payment_text'] = $materialize_settings_products['payment'][$this->config->get('config_language_id')]['text'];
					$data['payment_image'] = $this->model_tool_image->resize($materialize_settings_products['payment']['image'], $materialize_settings_products['payment']['image_width'], $materialize_settings_products['payment']['image_height']);
				} else {
					$data['payment_text'] = '';
					$data['payment_image'] = '';
				}
			}
			]]></add>
		</operation>
	</file>
	<!-- Disable button cart -->
	<file path="catalog/controller/product/compare.php">
		<operation error="log">
			<search><![CDATA[if ($product_info) {]]></search>
			<add position="after"><![CDATA[
			if (($product_info['quantity'] <= 0) && (!$this->config->get('config_stock_checkout')) || $product_info['price'] <= 0) {
				$add_cart = false;
			} else {
				$add_cart = true;
			}
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$data['products'][$product_id] = array(]]></search>
			<add position="after"><![CDATA['add_cart'	=> $add_cart,]]></add>
		</operation>
	</file>
	<file path="catalog/controller/product/product.php">
		<operation error="log">
			<search><![CDATA[if ($product_info) {]]></search>
			<add position="after"><![CDATA[
			if (($product_info['quantity'] <= 0) && (!$this->config->get('config_stock_checkout')) || $product_info['price'] <= 0) {
				$data['add_cart'] = false;
			} else {
				$data['add_cart'] = true;
			}
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/product/{category,manufacturer,product,search,special}*.php">
		<operation error="log">
			<search><![CDATA[$data['products'][] = array(]]></search>
			<add position="before"><![CDATA[
			if (($result['quantity'] <= 0) && (!$this->config->get('config_stock_checkout')) || $result['price'] <= 0) {
				$add_cart = false;
			} else {
				$add_cart = true;
			}
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$data['products'][] = array(]]></search>
			<add position="after"><![CDATA['add_cart'	=> $add_cart,]]></add>
		</operation>
	</file>
	<file path="catalog/controller/extension/module/{bestseller,latest,special}*.php">
		<operation error="log">
			<search><![CDATA[$data['products'][] = array(]]></search>
			<add position="before"><![CDATA[
			if (($result['quantity'] <= 0) && (!$this->config->get('config_stock_checkout')) || $result['price'] <= 0) {
				$add_cart = false;
			} else {
				$add_cart = true;
			}
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$data['products'][] = array(]]></search>
			<add position="after"><![CDATA['add_cart'	=> $add_cart,]]></add>
		</operation>
	</file>
	<file path="catalog/controller/extension/module/featured.php">
		<operation error="log">
			<search><![CDATA[$data['products'][] = array(]]></search>
			<add position="before"><![CDATA[
			if (($product_info['quantity'] <= 0) && (!$this->config->get('config_stock_checkout')) || $product_info['price'] <= 0) {
				$add_cart = false;
			} else {
				$add_cart = true;
			}
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$data['products'][] = array(]]></search>
			<add position="after"><![CDATA['add_cart'	=> $add_cart,]]></add>
		</operation>
	</file>
	<!-- Editing wishlist on the product page -->
	<file path="catalog/controller/product/product.php">
		<operation error="log">
			<search><![CDATA[if ($product_info) {]]></search>
			<add position="after"><![CDATA[
			$this->load->model('account/wishlist');

			$wishlist_product = $this->model_account_wishlist->selectWishlist($product_id);

			if (isset($wishlist_product)) {
				$data['wishlist_product'] = $wishlist_product;
			} else {
				$data['wishlist_product'] = '';
			}
			]]></add>
		</operation>
	</file>
	<file path="catalog/model/account/wishlist.php">
		<operation error="log">
			<search><![CDATA[class ModelAccountWishlist extends Model {]]></search>
			<add position="after"><![CDATA[
			public function selectWishlist($product_id) {
				$query = $this->db->query("SELECT * FROM " . DB_PREFIX . "customer_wishlist WHERE customer_id = '" . (int)$this->customer->getId() . "' AND product_id = '" . (int)$product_id . "'");

				return $query->rows;
			}
			]]></add>
		</operation>
	</file>
	<!-- Blog resize image -->
	<file path="catalog/model/tool/image.php">
		<operation error="log">
			<search><![CDATA[public function resize($filename, $width, $height) {]]></search>
			<add position="before"><![CDATA[
			public function resizeBlog($filename, $width, $height, $type = '') {
				if (!is_file(DIR_IMAGE . $filename) || substr(str_replace('\\', '/', realpath(DIR_IMAGE . $filename)), 0, strlen(DIR_IMAGE)) != str_replace('\\', '/', DIR_IMAGE)) {
					return;
				}

				$extension = pathinfo($filename, PATHINFO_EXTENSION);

				$image_old = $filename;
				$image_new = 'cache/' . utf8_substr($filename, 0, utf8_strrpos($filename, '.')) . '-' . (int)$width . 'x' . (int)$height . $type . '.' . $extension;

				if (!is_file(DIR_IMAGE . $image_new) || (filectime(DIR_IMAGE . $image_old) > filectime(DIR_IMAGE . $image_new))) {
					list($width_orig, $height_orig, $image_type) = getimagesize(DIR_IMAGE . $image_old);

					if (!in_array($image_type, array(IMAGETYPE_PNG, IMAGETYPE_JPEG, IMAGETYPE_GIF))) {
						return DIR_IMAGE . $image_old;
					}

					$path = '';

					$directories = explode('/', dirname($image_new));

					foreach ($directories as $directory) {
						$path = $path . '/' . $directory;

						if (!is_dir(DIR_IMAGE . $path)) {
							@mkdir(DIR_IMAGE . $path, 0777);
						}
					}

					if ($width_orig != $width || $height_orig != $height) {
						$image = new Image(DIR_IMAGE . $image_old);
						$image->resizeBlog($width, $height, $type);
						$image->save(DIR_IMAGE . $image_new);
					} else {
						copy(DIR_IMAGE . $image_old, DIR_IMAGE . $image_new);
					}
				}

				$image_new = str_replace(' ', '%20', $image_new);

				if ($this->request->server['HTTPS']) {
					return $this->config->get('config_ssl') . 'image/' . $image_new;
				} else {
					return $this->config->get('config_url') . 'image/' . $image_new;
				}
			}
			]]></add>
		</operation>
	</file>
	<file path="system/library/image.php">
		<operation error="log">
			<search><![CDATA[public function watermark($watermark, $position = 'bottomright') {]]></search>
			<add position="before"><![CDATA[
			public function resizeBlog($width = 0, $height = 0, $default = '') {
				if (!$this->width || !$this->height) {
					return;
				}

				$xpos = 0;
				$ypos = 0;
				$scale = 1;

				$scale_w = $width / $this->width;
				$scale_h = $height / $this->height;

				$scale = $scale_w;

				if ($scale == 1 && $scale_h == $scale_w && $this->mime != 'image/png') {
					return;
				}

				$new_width = (int)($this->width * $scale);
				$new_height = (int)($this->height * $scale);
				$xpos = 0;
				$ypos = 0;

				$image_old = $this->image;
				$this->image = imagecreatetruecolor($new_width, $new_height);

				if (isset($this->mime) && $this->mime == 'image/png') {
					imagealphablending($this->image, false);
					imagesavealpha($this->image, true);
					$background = imagecolorallocatealpha($this->image, 255, 255, 255, 127);
					imagecolortransparent($this->image, $background);
				} else {
					$background = imagecolorallocate($this->image, 255, 255, 255);
				}

				imagefilledrectangle($this->image, 0, 0, $new_width, $new_height, $background);

				imagecopyresampled($this->image, $image_old, $xpos, $ypos, 0, 0, $new_width, $new_height, $this->width, $this->height);
				imagedestroy($image_old);

				$this->width  = $new_width;
				$this->height = $new_height;
			}
			]]></add>
		</operation>
	</file>
	<!-- Crop image -->
	<file path="catalog/model/tool/image.php">
		<operation error="log">
			<search><![CDATA[public function resize($filename, $width, $height) {]]></search>
			<add position="replace"><![CDATA[public function resize($filename, $width, $height, $type = '') {]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$image_new = 'cache/' . utf8_substr($filename, 0, utf8_strrpos($filename, '.')) . '-' . (int)$width . 'x' . (int)$height . '.' . $extension;]]></search>
			<add position="replace"><![CDATA[$image_new = 'cache/' . utf8_substr($filename, 0, utf8_strrpos($filename, '.')) . '-' . (int)$width . 'x' . (int)$height . $type . '.' . $extension;]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$image->resize($width, $height);]]></search>
			<add position="replace"><![CDATA[$image->resize($width, $height, $type);]]></add>
		</operation>
	</file>
	<file path="system/library/image.php">
		<operation error="log">
			<search><![CDATA[} elseif ($default == 'h') {]]></search>
			<add position="after" offset="1"><![CDATA[
			} elseif ($default == 'crop') {
			if ($width/$height > $this->width/$this->height) {
				$scale = $scale_w;
			} elseif ($width/$height < $this->width/$this->height) {
				$scale = $scale_h;
			}
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[private function html2rgb($color) {]]></search>
			<add position="before"><![CDATA[
			private function imagecopymerge_alpha($dst_im, $src_im, $dst_x, $dst_y, $src_x, $src_y, $src_w, $src_h, $pct) {
				$w = imagesx($src_im);
				$h = imagesy($src_im);

				$cut = imagecreatetruecolor($src_w, $src_h);

				imagecopy($cut, $dst_im, 0, 0, $dst_x, $dst_y, $src_w, $src_h);

				imagecopy($cut, $src_im, 0, 0, $src_x, $src_y, $src_w, $src_h);
				imagecopymerge($dst_im, $cut, $dst_x, $dst_y, $src_x, $src_y, $src_w, $src_h, $pct);
			}
			]]></add>
		</operation>
	</file>
	<!-- Blog -->
	<file path="catalog/controller/startup/seo_url.php">
		<operation error="log">
			<search><![CDATA[if ($url[0] == 'category_id') {]]></search>
			<add position="before"><![CDATA[
			if ($url[0] == 'post_id') {
				$this->request->get['post_id'] = $url[1];
			}

			if ($url[0] == 'author_id') {
				$this->request->get['author_id'] = $url[1];
			}

			if ($url[0] == 'blog_category_id') {
				if (!isset($this->request->get['blog_path'])) {
					$this->request->get['blog_path'] = $url[1];
				} else {
					$this->request->get['blog_path'] .= '_' . $url[1];
				}
			}
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[if ($query->row['query'] && $url[0] != 'information_id' && $url[0] != 'manufacturer_id' && $url[0] != 'category_id' && $url[0] != 'product_id') {]]></search>
			<add position="replace" trim="true"><![CDATA[if ($query->row['query'] && $url[0] != 'information_id' && $url[0] != 'manufacturer_id' && $url[0] != 'category_id' && $url[0] != 'product_id' && $url[0] != 'blog_category_id' && $url[0] != 'author_id' && $url[0] != 'post_id') {]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[} elseif (isset($this->request->get['path'])) {]]></search>
			<add position="before"><![CDATA[
			} elseif (isset($this->request->get['post_id'])) {
				$this->request->get['route'] = 'extension/materialize/blog/post';
			} elseif (isset($this->request->get['blog_path'])) {
				$this->request->get['route'] = 'extension/materialize/blog/category';
			} elseif (isset($this->request->get['author_id'])) {
				$this->request->get['route'] = 'extension/materialize/blog/author/info';
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[if (($data['route'] == 'product/product' && $key == 'product_id') || (($data['route'] == 'product/manufacturer/info' || $data['route'] == 'product/product') && $key == 'manufacturer_id') || ($data['route'] == 'information/information' && $key == 'information_id')) {]]></search>
			<add position="replace" trim="true"><![CDATA[
			if (($data['route'] == 'product/product' && $key == 'product_id') || ($data['route'] == 'extension/materialize/blog/post' && $key == 'post_id') || (($data['route'] == 'product/manufacturer/info' || $data['route'] == 'product/product') && $key == 'manufacturer_id') || (($data['route'] == 'extension/materialize/blog/author/info' || $data['route'] == 'extension/materialize/blog/post') && $key == 'author_id') || ($data['route'] == 'information/information' && $key == 'information_id')) {
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[} elseif ($key == 'path') {]]></search>
			<add position="before"><![CDATA[
			} elseif ($key == 'blog_path') {
				$categories = explode('_', $value);

				foreach ($categories as $category) {
					$query = $this->db->query("SELECT * FROM " . DB_PREFIX . "seo_url WHERE `query` = 'blog_category_id=" . (int)$category . "' AND store_id = '" . (int)$this->config->get('config_store_id') . "' AND language_id = '" . (int)$this->config->get('config_language_id') . "'");

					if ($query->num_rows && $query->row['keyword']) {
						$url .= '/' . $query->row['keyword'];
					} else {
						$url = '';

						break;
					}
				}

				unset($data[$key]);
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/extension/seo_pro.php">
		<operation error="log">
			<search><![CDATA[if ($url[0] == 'category_id') {]]></search>
			<add position="before"><![CDATA[
			if ($url[0] == 'blog_category_id') {
				if (!isset($this->request->get['blog_path'])) {
					$this->request->get['blog_path'] = $url[1];
				} else {
					$this->request->get['blog_path'] .= '_' . $url[1];
				}
			} else
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[if (isset($this->request->get['product_id'])) {]]></search>
			<add position="before"><![CDATA[
			if (isset($this->request->get['post_id'])) {
				$this->request->get['route'] = 'extension/materialize/blog/post';
				if (!isset($this->request->get['blog_path'])) {
					$path = $this->getPathByBlogPost($this->request->get['post_id']);
					if ($path) $this->request->get['blog_path'] = $path;
				}
			} elseif (isset($this->request->get['blog_path'])) {
				$this->request->get['route'] = 'extension/materialize/blog/category';
			} else
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$this->request->get['route'] = 'product/manufacturer/info';]]></search>
			<add position="after"><![CDATA[
			} elseif (isset($this->request->get['author_id'])) {
				$this->request->get['route'] = 'extension/materialize/blog/author/info';
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[case 'product/product':]]></search>
			<add position="before"><![CDATA[
			case 'extension/materialize/blog/post':
				if (isset($data['post_id'])) {
					$tmp = $data;
					$data = array();
					if ($this->config->get('config_seo_url_include_path')) {
						$data['blog_path'] = $this->getPathByBlogPost($tmp['post_id']);
						if (!$data['blog_path']) return $link;
					}
					$data['post_id'] = $tmp['post_id'];
				}
				break;

			case 'extension/materialize/blog/category':
				if (isset($data['blog_path'])) {
					$category = explode('_', $data['blog_path']);
					$category = end($category);
					$data['blog_path'] = $this->getPathByBlogCategory($category);
					if (!$data['blog_path']) return $link;
				}
				break;
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[case 'product_id':]]></search>
			<add position="before"><![CDATA[
			case 'blog_path':
				$categories = explode('_', $value);
				foreach($categories as $category) {
					$queries[] = 'blog_category_id=' . $category;
				}
				unset($data[$key]);
				break;

			case 'post_id':
			case 'blog_category_id':
			case 'author_id':
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[private function getPathByProduct($product_id) {]]></search>
			<add position="before"><![CDATA[
			private function getPathByBlogPost($post_id) {
				$post_id = (int)$post_id;
				if ($post_id < 1) return false;

				static $path = null;
				if (!isset($path)) {
					$path = $this->cache->get('blog.post.seopath');
					if (!isset($path)) $path = array();
				}

				if (!isset($path[$post_id])) {
					$query = $this->db->query("SELECT blog_category_id FROM " . DB_PREFIX . "post_to_category WHERE post_id = '" . $post_id . "' ORDER BY main_category DESC LIMIT 1");

					$path[$post_id] = $this->getPathByBlogCategory($query->num_rows ? (int)$query->row['blog_category_id'] : 0);

					$this->cache->set('blog.post.seopath', $path);
				}

				return $path[$post_id];
			}

			private function getPathByBlogCategory($blog_category_id) {
				$blog_category_id = (int)$blog_category_id;
				if ($blog_category_id < 1) return false;

				static $path = null;
				if (!isset($path)) {
					$path = $this->cache->get('blog.category.seopath');
					if (!isset($path)) $path = array();
				}

				if (!isset($path[$blog_category_id])) {
					$max_level = 10;

					$sql = "SELECT CONCAT_WS('_'";
					for ($i = $max_level-1; $i >= 0; --$i) {
						$sql .= ",t$i.blog_category_id";
					}
					$sql .= ") AS path FROM " . DB_PREFIX . "blog_category t0";
					for ($i = 1; $i < $max_level; ++$i) {
						$sql .= " LEFT JOIN " . DB_PREFIX . "blog_category t$i ON (t$i.blog_category_id = t" . ($i-1) . ".parent_id)";
					}
					$sql .= " WHERE t0.blog_category_id = '" . $blog_category_id . "'";

					$query = $this->db->query($sql);

					$path[$blog_category_id] = $query->num_rows ? $query->row['path'] : false;

					$this->cache->set('blog.category.seopath', $path);
				}

				return $path[$blog_category_id];
			}
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/information/sitemap.php">
		<operation error="log">
			<search><![CDATA[public function index() {]]></search>
			<add position="after"><![CDATA[
			if ($this->config->get('module_blog_status') == 1) {
			 	$data['module_blog'] = true;

				$this->load->model('extension/materialize/blog');

				$data['blog_categories'] = array();

				$categories_1 = $this->model_extension_materialize_blog->getCategories(0);

				foreach ($categories_1 as $category_1) {
					$level_2_data = array();

					$categories_2 = $this->model_extension_materialize_blog->getCategories($category_1['blog_category_id']);

					foreach ($categories_2 as $category_2) {
						$level_3_data = array();

						$categories_3 = $this->model_extension_materialize_blog->getCategories($category_2['blog_category_id']);

						foreach ($categories_3 as $category_3) {
							$level_3_data[] = array(
								'name'	=> $category_3['name'],
								'href'	=> $this->url->link('extension/materialize/blog/category', 'blog_path=' . $category_1['blog_category_id'] . '_' . $category_2['blog_category_id'] . '_' . $category_3['blog_category_id'])
							);
						}

						$level_2_data[] = array(
							'name'		=> $category_2['name'],
							'children'	=> $level_3_data,
							'href'		=> $this->url->link('extension/materialize/blog/category', 'blog_path=' . $category_1['blog_category_id'] . '_' . $category_2['blog_category_id'])
						);
					}

					$data['blog_categories'][] = array(
						'name'		=> $category_1['name'],
						'children'	=> $level_2_data,
						'href'		=> $this->url->link('extension/materialize/blog/category', 'blog_path=' . $category_1['blog_category_id'])
					);
				}
			} else {
			 	$data['module_blog'] = false;
			}
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/extension/feed/google_sitemap.php">
		<operation error="log">
			<search><![CDATA[$this->load->model('tool/image');]]></search>
			<add position="after"><![CDATA[
			if ($this->config->get('module_blog_status') == 1) {
				$this->load->model('extension/materialize/blog');

				$posts = $this->model_extension_materialize_blog->getPosts();

				foreach ($posts as $post) {
					if ($post['image']) {
						$output .= '<url>';
						$output .= '<loc>' . $this->url->link('extension/materialize/blog/post', 'post_id=' . $post['post_id']) . '</loc>';
						$output .= '<changefreq>weekly</changefreq>';
						$output .= '<lastmod>' . date('Y-m-d\TH:i:sP', strtotime($post['date_modified'])) . '</lastmod>';
						$output .= '<priority>1.0</priority>';
						$output .= '<image:image>';
						$output .= '<image:loc>' . $this->model_tool_image->resize($post['image'], 1000, 800, 'crop') . '</image:loc>';
						$output .= '<image:caption>' . $post['name'] . '</image:caption>';
						$output .= '<image:title>' . $post['name'] . '</image:title>';
						$output .= '</image:image>';
						$output .= '</url>';
					}
				}

				$authors = $this->model_extension_materialize_blog->getAuthors();

				foreach ($authors as $author) {
					$output .= '<url>';
					$output .= '<loc>' . $this->url->link('extension/materialize/blog/author/info', 'author_id=' . $author['author_id']) . '</loc>';
					$output .= '<changefreq>weekly</changefreq>';
					$output .= '<priority>0.7</priority>';
					$output .= '</url>';

					$posts = $this->model_extension_materialize_blog->getPosts(array('filter_author_id' => $author['author_id']));

					foreach ($posts as $post) {
						$output .= '<url>';
						$output .= '<loc>' . $this->url->link('extension/materialize/blog/post', 'author_id=' . $author['author_id'] . '&post_id=' . $post['post_id']) . '</loc>';
						$output .= '<changefreq>weekly</changefreq>';
						$output .= '<priority>1.0</priority>';
						$output .= '</url>';
					}
				}

				$output .= $this->getBlogCategories(0);
			}
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[protected function getCategories($parent_id, $current_path = '') {]]></search>
			<add position="before"><![CDATA[
			protected function getBlogCategories($parent_id, $current_path = '') {
				$output = '';

				$results = $this->model_extension_materialize_blog->getCategories($parent_id);

				foreach ($results as $result) {
					if (!$current_path) {
						$new_path = $result['blog_category_id'];
					} else {
						$new_path = $current_path . '_' . $result['blog_category_id'];
					}

					$output .= '<url>';
					$output .= '<loc>' . $this->url->link('extension/materialize/blog/category', 'blog_path=' . $new_path) . '</loc>';
					$output .= '<changefreq>weekly</changefreq>';
					$output .= '<priority>0.7</priority>';
					$output .= '</url>';

					$posts = $this->model_extension_materialize_blog->getPosts(array('filter_category_id' => $result['blog_category_id']));

					foreach ($posts as $post) {
						$output .= '<url>';
						$output .= '<loc>' . $this->url->link('extension/materialize/blog/post', 'blog_path=' . $new_path . '&post_id=' . $post['post_id']) . '</loc>';
						$output .= '<changefreq>weekly</changefreq>';
						$output .= '<priority>1.0</priority>';
						$output .= '</url>';
					}

					$output .= $this->getBlogCategories($result['blog_category_id'], $new_path);
				}

				return $output;
			}
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/common/header.php">
		<operation error="log">
			<search><![CDATA[public function index() {]]></search>
			<add position="after"><![CDATA[
			if ($this->config->get('module_blog_status') == 1) {
				$data['blog'] = $this->url->link('extension/materialize/blog/blog');
			} else {
				$data['blog'] = '';
			}
			]]></add>
		</operation>
	</file>
	<!-- Integration of the logo module into invoices -->
	<file path="admin/model/sale/order.php">
		<operation error="log">
			<search index="0"><![CDATA[return $query->row['total'];]]></search>
			<add position="after" offset="2"><![CDATA[
			public function getProductImage($product_id) {
				$query = $this->db->query("SELECT image FROM " . DB_PREFIX . "product WHERE product_id = '" . (int)$product_id . "'");
				return $query->row;
			}
			]]></add>
		</operation>
	</file>
	<file path="admin/controller/sale/order.php">
		<operation error="log">
			<search><![CDATA[$store_fax = $store_info['config_fax'];]]></search>
			<add position="after"><![CDATA[$store_logo = $store_info['config_logo'];]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[=> $order_info['store_name'],]]></search>
			<add position="after"><![CDATA['logo'	=> HTTP_CATALOG . 'image/' .$store_info['config_logo'],]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$option_data = array();]]></search>
			<add position="after"><![CDATA[$product['img'] = $this->model_sale_order->getProductImage($product['product_id']);]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$product_data[] = array(]]></search>
			<add position="before"><![CDATA[$this->load->model('tool/image');]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$product_data[] = array(]]></search>
			<add position="after"><![CDATA[
			'image'	=> $this->model_tool_image->resize($product['img']['image'], $this->config->get($this->config->get('config_theme') . '_image_cart_width'), $this->config->get($this->config->get('config_theme') . '_image_cart_height')),
			'width'	=> $this->config->get($this->config->get('config_theme') . '_image_cart_width'),
			]]></add>
		</operation>
	</file>
	<file path="admin/view/template/sale/order_shipping.twig">
		<operation error="log">
			<search><![CDATA[<div style="page-break-after: always;">]]></search>
			<add position="after"><![CDATA[<img src={{ order.logo }} />]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[<td><b>{{ column_product }}</b></td>]]></search>
			<add position="replace"><![CDATA[<td colspan="2"><b>{{ column_product }}</b></td>]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[<td>{{ product.name }}]]></search>
			<add position="before"><![CDATA[<td style="width:{{ product.width }}px"><img src="{{ product.image }}"></td>]]></add>
		</operation>
	</file>
	<file path="admin/view/template/sale/order_invoice.twig">
		<operation error="log">
			<search><![CDATA[<div style="page-break-after: always;">]]></search>
			<add position="after"><![CDATA[<img src={{ order.logo }} />]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[<td><b>{{ column_product }}</b></td>]]></search>
			<add position="replace"><![CDATA[<td colspan="2"><b>{{ column_product }}</b></td>]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[<td>{{ product.name }}]]></search>
			<add position="before"><![CDATA[<td style="width:{{ product.width }}px"><img src="{{ product.image }}"></td>]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[colspan="4"]]></search>
			<add position="replace"><![CDATA[colspan="5"]]></add>
		</operation>
	</file>
	<!-- Subcategory chip -->
	<file path="catalog/controller/product/category.php">
		<operation error="log">
			<search><![CDATA[$data['categories'][] = array(]]></search>
			<add position="replace" offset="3"><![CDATA[
			if ($result['image']) {
				$image = $this->model_tool_image->resize($result['image'], 32, 32);
			} else {
				$image = '';
			}

			$data['categories'][] = array(
				'name'	=> $result['name'] . ($this->config->get('config_product_count') ? ' (' . $this->model_catalog_product->getTotalProducts($filter_data) . ')' : ''),
				'href'	=> $this->url->link('product/category', 'path=' . $this->request->get['path'] . '_' . $result['category_id'] . $url),
				'thumb'	=> $image
			);
			]]></add>
		</operation>
	</file>
	<!-- Product meta data -->
	<file path="catalog/controller/product/product.php">
		<operation error="log">
			<search><![CDATA[if ($product_info) {]]></search>
			<add position="after"><![CDATA[
			$data['pricecurrency'] = $this->session->data['currency'];
			$data['reviewCount'] = (int)$product_info['reviews'];
			]]></add>
		</operation>
	</file>
	<!-- Add category in product card -->
	<file path="catalog/controller/product/product.php">
		<operation error="log">
			<search><![CDATA[if ($product_info) {]]></search>
			<add position="after"><![CDATA[
			$this->load->model('catalog/category');

			$product_categories = $this->model_catalog_product->getCategories($product_id);

			foreach ($product_categories as $product_category) {
				$category_info = $this->model_catalog_category->getCategory($product_category['category_id']);

				if ($category_info) {
					$data['category_products'][] = array(
						'name'	=> $category_info['name'],
						'href'	=> $this->url->link('product/category', 'path=' . $category_info['category_id'])
					);
				}
			}
			]]></add>
		</operation>
	</file>
	<!-- End of promotion -->
	<file path="catalog/model/catalog/product.php">
		<operation error="log">
			<search><![CDATA[class ModelCatalogProduct extends Model {]]></search>
			<add position="after"><![CDATA[
			public function getProductSpec($product_id) {
				$sql = $this->db->query("SELECT ps.date_end FROM " . DB_PREFIX . "product_special ps WHERE product_id = '" . (int)$product_id . "' AND ((ps.date_start = '0000-00-00' OR ps.date_start < NOW()) AND (ps.date_end = '0000-00-00' OR ps.date_end > NOW())) ORDER BY ps.priority ASC");
				if ($sql->num_rows) {
					return $sql->row['date_end'];
				} else {
					return false;
				}
			}
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/product/product.php">
		<operation error="log">
			<search><![CDATA[if ($product_info) {]]></search>
			<add position="after"><![CDATA[
			$data['product_spec'] = $this->model_catalog_product->getProductSpec($product_id);
			$data['end_promotion'] = date($this->language->get('date_format_short'), strtotime($this->model_catalog_product->getProductSpec($product_id)));
			]]></add>
		</operation>
	</file>
	<!-- Sort by availability -->
	<file path="catalog/model/catalog/product.php">
		<operation error="log">
			<search><![CDATA[$sql .= " ORDER BY LCASE(" . $data['sort'] . ")";]]></search>
			<add position="replace"><![CDATA[$sql .= " ORDER BY (p.quantity>0) DESC, LCASE(" . $data['sort'] . ")";]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$sql .= " ORDER BY (CASE WHEN special IS NOT NULL THEN special WHEN discount IS NOT NULL THEN discount ELSE p.price END)";]]></search>
			<add position="replace"><![CDATA[$sql .= " ORDER BY (p.quantity>0) DESC, (CASE WHEN special IS NOT NULL THEN special WHEN discount IS NOT NULL THEN discount ELSE p.price END)";]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$sql .= " ORDER BY " . $data['sort'];]]></search>
			<add position="replace"><![CDATA[$sql .= " ORDER BY (p.quantity>0) DESC," . $data['sort'];]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$sql .= " ORDER BY p.sort_order";]]></search>
			<add position="replace"><![CDATA[$sql .= " ORDER BY (p.quantity>0) DESC, p.sort_order";]]></add>
		</operation>
	</file>
	<!-- Instock on category page -->
	<file path="catalog/controller/product/category.php">
		<operation error="log">
			<search><![CDATA[$data['breadcrumbs'] = array();]]></search>
			<add position="before"><![CDATA[
			if (isset($this->request->get['instock'])) {
				$instock = $this->request->get['instock'];
			} else {
				$instock = '';
			}
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$filter,]]></search>
			<add position="after"><![CDATA['filter_instock'     => $instock,]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$data['limit'] = $limit;]]></search>
			<add position="after"><![CDATA[
			$data['url'] = html_entity_decode($this->url->link('product/category', 'path=' . $this->request->get['path'] . $url), ENT_QUOTES, 'UTF-8');
			$data['instock'] = $instock;
			]]></add>
		</operation>
	</file>
	<file path="catalog/model/catalog/product.php">
		<operation error="log">
			<search><![CDATA[if (!empty($data['filter_name']) || !empty($data['filter_tag'])) {]]></search>
			<add position="before"><![CDATA[
			if (!empty($data['filter_instock'])) {
				$sql .= " AND (p.stock_status_id = '7' OR p.quantity > 0)";
			}
			]]></add>
		</operation>
	</file>
	<!-- Add badges in category product count -->
	<file path="catalog/controller/common/menu.php">
		<operation error="log">
			<search><![CDATA['name'  => $child['name'] . ($this->config->get('config_product_count') ? ' (' . $this->model_catalog_product->getTotalProducts($filter_data) . ')' : ''),]]></search>
			<add position="replace"><![CDATA['name' => ($this->config->get('config_product_count') ? '<span class="new-badge" data-badge="' . $this->model_catalog_product->getTotalProducts($filter_data) . '">' . $child['name'] . '</span>' : $child['name']),]]></add>
		</operation>
	</file>
	<file path="catalog/controller/extension/module/category.php">
		<operation error="log">
			<search><![CDATA['name' => $child['name'] . ($this->config->get('config_product_count') ? ' (' . $this->model_catalog_product->getTotalProducts($filter_data) . ')' : ''),]]></search>
			<add position="replace"><![CDATA['name' => ($this->config->get('config_product_count') ? '<span class="new-badge" data-badge="' . $this->model_catalog_product->getTotalProducts($filter_data) . '">' . $child['name'] . '</span>' : $child['name']),]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA['name'        => $category['name'] . ($this->config->get('config_product_count') ? ' (' . $this->model_catalog_product->getTotalProducts($filter_data) . ')' : ''),]]></search>
			<add position="replace"><![CDATA['name'	=> ($this->config->get('config_product_count') ? '<span class="new-badge" data-badge="' . $this->model_catalog_product->getTotalProducts($filter_data) . '">' . $category['name'] . '</span>' : $category['name']),]]></add>
		</operation>
	</file>
	<!-- Related products -->
	<file path="admin/model/catalog/product.php">
		<operation error="log">
			<search><![CDATA[$this->db->query("DELETE FROM " . DB_PREFIX . "product_related WHERE product_id = '" . (int)$related_id . "' AND related_id = '" . (int)$product_id . "'");]]></search>
			<add position="replace"><![CDATA[]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$this->db->query("INSERT INTO " . DB_PREFIX . "product_related SET product_id = '" . (int)$related_id . "', related_id = '" . (int)$product_id . "'");]]></search>
			<add position="replace"><![CDATA[]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$this->db->query("DELETE FROM " . DB_PREFIX . "product_related WHERE related_id = '" . (int)$product_id . "'");]]></search>
			<add position="replace"><![CDATA[]]></add>
		</operation>
	</file>
	<!-- Displays the discount percentage -->
	<file path="catalog/controller/product/{category,manufacturer,product,search,special}*.php">
		<operation error="log">
			<search><![CDATA[$special = $this->currency->format($this->tax->calculate($result['special'], $result['tax_class_id'], $this->config->get('config_tax')), $this->session->data['currency']);]]></search>
			<add position="after"><![CDATA[$percent_discount = round(100-($result['special']/($result['price']/100)));]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$special = false;]]></search>
			<add position="after"><![CDATA[$percent_discount = false;]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA['special'     => $special,]]></search>
			<add position="after"><![CDATA['percent_discount'	=> $percent_discount,]]></add>
		</operation>
	</file>
	<file path="catalog/controller/product/product.php">
		<operation error="log">
			<search><![CDATA[$data['special'] = $this->currency->format($this->tax->calculate($product_info['special'], $product_info['tax_class_id'], $this->config->get('config_tax')), $this->session->data['currency']);]]></search>
			<add position="after"><![CDATA[$data['percent_discount'] = round(100-($product_info['special']/($product_info['price']/100)));]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$data['special'] = false;]]></search>
			<add position="after"><![CDATA[$data['percent_discount'] = false;]]></add>
		</operation>
	</file>
	<file path="catalog/controller/extension/module/{bestseller,latest,special}*.php">
		<operation error="log">
			<search><![CDATA[$special = $this->currency->format($this->tax->calculate($result['special'], $result['tax_class_id'], $this->config->get('config_tax')), $this->session->data['currency']);]]></search>
			<add position="after"><![CDATA[$percent_discount = round(100-($result['special']/($result['price']/100)));]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$special = false;]]></search>
			<add position="after"><![CDATA[$percent_discount = false;]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA['special'     => $special,]]></search>
			<add position="after"><![CDATA['percent_discount'	=> $percent_discount,]]></add>
		</operation>
	</file>
	<file path="catalog/controller/extension/module/featured.php">
		<operation error="log">
			<search><![CDATA[$special = $this->currency->format($this->tax->calculate($product_info['special'], $product_info['tax_class_id'], $this->config->get('config_tax')), $this->session->data['currency']);]]></search>
			<add position="after"><![CDATA[$percent_discount = round(100-($product_info['special']/($product_info['price']/100)));]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$special = false;]]></search>
			<add position="after"><![CDATA[$percent_discount = false;]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$data['products'][] = array(]]></search>
			<add position="after"><![CDATA['percent_discount'	=> $percent_discount,]]></add>
		</operation>
	</file>
	<!-- Adding the manufacturer's logo on the product card -->
	<file path="catalog/controller/product/product.php">
		<operation error="log">
			<search><![CDATA[$this->load->model('tool/image');]]></search>
			<add position="after"><![CDATA[
			$manufacturer_image = $this->model_catalog_manufacturer->getManufacturer($product_info['manufacturer_id']);

			if ($manufacturer_image) {
				$data['manufacturers_img'] = $this->model_tool_image->resize($manufacturer_image['image'], 100, 100);
			} else {
				$data['manufacturers_img'] = false;
			}
			]]>
			</add>
		</operation>
	</file>
	<!-- Adding the manufacturer's logo on the manufacturer's list -->
	<file path="catalog/controller/product/manufacturer.php">
		<operation error="log">
			<search><![CDATA['name' => $result['name'],]]></search>
			<add position="after"><![CDATA['logo' => $this->model_tool_image->resize($result['image'], 100, 100),]]>
			</add>
		</operation>
	</file>
	<!-- Stock Statuses -->
	<file path="catalog/model/catalog/product.php">
		<operation error="log">
			<search><![CDATA[return array(]]></search>
			<add position="after"><![CDATA['stock_status_id'  => $query->row['stock_status_id'],]]>
			</add>
		</operation>
	</file>
	<file path="catalog/controller/product/product.php">
		<operation error="log">
			<search><![CDATA[if ($product_info) {]]></search>
			<add position="after"><![CDATA[$data['stock_status_id'] = $product_info['stock_status_id'];]]>
			</add>
		</operation>
		<operation error="log">
			<search><![CDATA[$data['stock'] = $product_info['quantity'];]]></search>
			<add position="after"><![CDATA[
			$data['stock_color'] = "green";
			$data['stock_status'] = "http://schema.org/InStock";
			]]>
			</add>
		</operation>
		<operation error="log">
			<search><![CDATA[$data['stock'] = $this->language->get('text_instock');]]></search>
			<add position="after"><![CDATA[
			$data['stock_color'] = "green";
			$data['stock_status'] = "http://schema.org/InStock";
			]]>
			</add>
		</operation>
		<operation error="log">
			<search><![CDATA[$data['stock'] = $product_info['stock_status'];]]></search>
			<add position="after"><![CDATA[
			if($data['stock_status_id'] == 5) {
				$data['stock_color'] = "red";
				$data['stock_status'] = "http://schema.org/OutOfStock";
			} elseif ($data['stock_status_id'] == 8) {
				$data['stock_color'] = "orange";
				$data['stock_status'] = "http://schema.org/PreOrder";
			} elseif ($data['stock_status_id'] == 6) {
				$data['stock_color'] = "lime";
				$data['stock_status'] = "http://schema.org/OutOfStock";
			} elseif ($data['stock_status_id'] == 7) {
				$data['stock_color'] = "green";
				$data['stock_status'] = "http://schema.org/InStock";
			} else {
				$data['stock_color'] = "grey";
				$data['stock_status'] = "";
			}
			]]>
			</add>
		</operation>
	</file>
	<!-- Additional Fields https://www.opencart.com/index.php?route=marketplace/extension/info&extension_id=25379 -->
	<file path="admin/controller/catalog/product.php">
		<operation error="log">
			<search><![CDATA[protected function getForm() {]]></search>
			<add position="after"><![CDATA[
			if ($this->config->get('module_additionalfields_status') == 1) {
				$data['module_additionalfields'] = true;

				if (isset($this->request->post['product_additionalfield'])) {
					$data['product_additionalfields'] = $this->request->post['product_additionalfield'];
				} elseif (isset($this->request->get['product_id'])) {
					$data['product_additionalfields'] = $this->model_catalog_product->getProductadditionalfields($this->request->get['product_id']);
				} else {
					$data['product_additionalfields'] = array();
				}
			} else {
				$data['module_additionalfields'] = false;
			}
			]]></add>
		</operation>
	</file>
	<file path="admin/model/catalog/product.php">
		<operation error="log">
			<search><![CDATA[$product_id = $this->db->getLastId();]]></search>
			<add position="after"><![CDATA[
			if ($this->config->get('module_additionalfields_status') == 1) {
				if (isset($data['product_additionalfield'])) {
					foreach ($data['product_additionalfield'] as $product_additionalfield) {
						$this->db->query("INSERT INTO " . DB_PREFIX . "product_additionalfield SET product_id = '" . (int)$product_id . "', sort_order = '" . (int)$product_additionalfield['sort_order'] . "', status = '" . (int)$product_additionalfield['status'] . "'");

						$product_additionalfield_id = $this->db->getLastId();

						foreach ($product_additionalfield['product_additionalfield_text'] as $language_id => $product_additionalfield_text) {
							$this->db->query("INSERT INTO " . DB_PREFIX . "product_additionalfield_text SET product_additionalfield_id = '" . (int)$product_additionalfield_id . "', language_id = '" . (int)$language_id . "', product_id = '" . (int)$product_id . "', title = '" . $this->db->escape($product_additionalfield_text['title']) . "', text = '" . $this->db->escape($product_additionalfield_text['text']) . "'");
						}
					}
				}
			}
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[public function editProduct($product_id, $data) {]]></search>
			<add position="after"><![CDATA[
			if ($this->config->get('module_additionalfields_status') == 1) {
				$this->db->query("DELETE FROM " . DB_PREFIX . "product_additionalfield WHERE product_id = '" . (int)$product_id . "'");
				$this->db->query("DELETE FROM " . DB_PREFIX . "product_additionalfield_text WHERE product_id = '" . (int)$product_id . "'");

				if (isset($data['product_additionalfield'])) {
					foreach ($data['product_additionalfield'] as $product_additionalfield) {
						$this->db->query("INSERT INTO " . DB_PREFIX . "product_additionalfield SET product_id = '" . (int)$product_id . "', sort_order = '" . (int)$product_additionalfield['sort_order'] . "', status = '" . (int)$product_additionalfield['status'] . "'");

						$product_additionalfield_id = $this->db->getLastId();

						foreach ($product_additionalfield['product_additionalfield_text'] as $language_id => $product_additionalfield_text) {
							$this->db->query("INSERT INTO " . DB_PREFIX . "product_additionalfield_text SET product_additionalfield_id = '" . (int)$product_additionalfield_id . "', language_id = '" . (int)$language_id . "', product_id = '" . (int)$product_id . "', title = '" . $this->db->escape($product_additionalfield_text['title']) . "', text = '" . $this->db->escape($product_additionalfield_text['text']) . "'");
						}
					}
				}
			}
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[class ModelCatalogProduct extends Model {]]></search>
			<add position="after"><![CDATA[
			public function getProductadditionalfields($product_id) {
				$product_additionalfield_data = array();

				$product_additionalfield_query = $this->db->query("SELECT * FROM " . DB_PREFIX . "product_additionalfield WHERE product_id = '" . (int)$product_id . "' ORDER BY sort_order ASC");

				foreach ($product_additionalfield_query->rows as $product_additionalfield) {
					$product_additionalfield_text_data = array();
					$product_additionalfield_text_query = $this->db->query("SELECT * FROM " . DB_PREFIX . "product_additionalfield_text WHERE product_additionalfield_id = '" . (int)$product_additionalfield['product_additionalfield_id'] . "' AND product_id = '" . (int)$product_id . "'");

					foreach ($product_additionalfield_text_query->rows as $product_additionalfield_text) {
						$product_additionalfield_text_data[$product_additionalfield_text['language_id']] = array(
							'title'	=> $product_additionalfield_text['title'],
							'text'	=> $product_additionalfield_text['text'],
						);
					}

					$product_additionalfield_data[] = array(
						'product_additionalfield_text'	=> $product_additionalfield_text_data,
						'status'						=> $product_additionalfield['status'],
						'sort_order'					=> $product_additionalfield['sort_order']
					);
				}
				return $product_additionalfield_data;
			}
			]]></add>
		</operation>
	</file>
	<file path="admin/view/template/catalog/product_form.twig">
		<operation error="log">
			<search><![CDATA[<li><a href="#tab-design" data-toggle="tab">{{ tab_design }}</a></li>]]></search>
			<add position="after"><![CDATA[
			{% if module_additionalfields %}
				<li><a href="#tab-additionalfieldmain" data-toggle="tab">{{ text_additionalfield }}</a></li>
			{% endif %}
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[<div class="tab-pane" id="tab-design">]]></search>
			<add position="before"><![CDATA[
			{% if module_additionalfields %}
				<div class="tab-pane" id="tab-additionalfieldmain">
					<div class="col-sm-2">
						<ul class="nav nav-pills nav-stacked" id="additionalfield">
							{% set additionalfield_row = 0 %}
							{% for product_additionalfield in product_additionalfields %}
							<li><a href="#tab-additionalfield{{ additionalfield_row }}" data-toggle="tab"><i class="fa fa-minus-circle" onclick="$('a[href=\'#tab-additionalfield{{ additionalfield_row }}\']').parent().remove(); $('#tab-additionalfield{{ additionalfield_row }}').remove(); $('#additionalfield a:first').tab('show');"></i> {{ text_additionalfield }} {{ additionalfield_row }}</a></li>
							{% set additionalfield_row = additionalfield_row + 1 %}
							{% endfor %}
							<li id="additionalfield-add"><a onclick="addadditionalfield();"><i class="fa fa-plus-circle"></i> {{ text_add_additionalfield }}</a></li>
						</ul>
					</div>
					<div class="col-sm-10">
						<div class="tab-content tab-content2">
							{% set additionalfield_row = 0 %}
							{% for product_additionalfield in product_additionalfields %}
							<div class="tab-pane" id="tab-additionalfield{{ additionalfield_row }}">
								<ul class="nav nav-tabs" id="clanguage{{ additionalfield_row }}">
									{% for language in languages %}
									<li><a href="#tab-additionalfield{{additionalfield_row }}-language{{ language.language_id }}" data-toggle="tab"><img src="language/{{ language.code }}/{{ language.code }}.png" title="{{ language.name }}" />  {{ language.name }}</a></li>
									{% endfor %}
								</ul>
								<div class="tab-content">
									{% for language in languages %}
										<div class="tab-pane" id="tab-additionalfield{{additionalfield_row }}-language{{ language.language_id }}">
											<div class="form-group">
												<label class="col-sm-2 control-label" for="input-heading{{additionalfield_row }}-language{{ language.language_id }}">{{ text_additionalfield_title }}</label>
												<div class="col-sm-10">
													<input type="text" name="product_additionalfield[{{additionalfield_row }}][product_additionalfield_text][{{ language.language_id }}][title]" placeholder="{{ text_additionalfield_title }}" value="{{ product_additionalfield.product_additionalfield_text[language.language_id] ? product_additionalfield.product_additionalfield_text[language.language_id].title }}" class="form-control"/>
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-2 control-label" for="input-text{{additionalfield_row }}-language{{ language.language_id }}">{{ entry_text }}</label>
												<div class="col-sm-10">
													<input type="text" name="product_additionalfield[{{additionalfield_row }}][product_additionalfield_text][{{ language.language_id }}][text]" value="{{ product_additionalfield.product_additionalfield_text[language.language_id] ? product_additionalfield.product_additionalfield_text[language.language_id].text }}" placeholder="{{ entry_text }}" id="input-text{{additionalfield_row }}-language{{ language.language_id }}" class="form-control"/>
												</div>
											</div>
										</div>
									{% endfor %}
								</div>
								<div class="form-group">
									<label class="col-sm-2 control-label" for="input-sort_order{{ additionalfield_row }}">{{ entry_sort_order }}</label>
									<div class="col-sm-10">
										<input type="text" name="product_additionalfield[{{ additionalfield_row }}][sort_order]" value="{{ product_additionalfield.sort_order }}" placeholder="{{ entry_sort_order }}" class="form-control" />
									</div>
								</div>
								<div class="form-group">
									<label class="col-sm-2 control-label" for="input-status{{ additionalfield_row }}">{{ entry_status }}</label>
									<div class="col-sm-10">
										<select name="product_additionalfield[{{ additionalfield_row }}][status]" id="input-status" class="form-control">
											{% if product_additionalfield.status %}
											<option value="1" selected="selected">{{ text_enabled }}</option>
											<option value="0">{{ text_disabled }}</option>
											{% else %}
											<option value="1">{{ text_enabled }}</option>
											<option value="0" selected="selected">{{ text_disabled }}</option>
											{% endif %}
										</select>
									</div>
								</div>
							</div>
							{% set additionalfield_row = additionalfield_row + 1 %}
							{% endfor %}
						</div>
					</div>
				</div>
			{% endif %}
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[{{ footer }}]]></search>
			<add position="before"><![CDATA[
			{% if module_additionalfields %}
				<script type="text/javascript"><!--
				{% set additionalfield_row = 0 %}
				{% for product_additionalfield in product_additionalfields %}
				{% for language in languages %}
				$('#input-text{{ additionalfield_row }}-language{{ language.language_id }}');
				{% endfor %}
				{% set additionalfield_row = additionalfield_row + 1 %}
				{% endfor %}
				//--></script>

				<script type="text/javascript"><!--
				var additionalfield_row = {{ additionalfield_row }};

				function addadditionalfield() {
					html  = '<div id="tab-additionalfield' + additionalfield_row + '" class="tab-pane">';
					html += '	<ul class="nav nav-tabs" id="clanguage' + additionalfield_row + '">';
					{% for language in languages %}
					html += '		<li><a href="#tab-additionalfield' + additionalfield_row + '-language{{ language.language_id }}" data-toggle="tab"><img src="language/{{ language.code }}/{{ language.code }}.png" title="{{ language.name }}" /> {{ language.name }}</a></li>';
					{% endfor %}
					html += '	</ul>';

					html += '	<div class="tab-content">';
					{% for language in languages %}
					html += '		<div class="tab-pane" id="tab-additionalfield' + additionalfield_row + '-language{{ language.language_id }}">';
					html += '			<div class="form-group">';
					html += '				<label class="col-sm-2 control-label" for="input-title' + additionalfield_row + '-language{{ language.language_id }}">{{ text_additionalfield_title }}</label>';
					html += '				<div class="col-sm-10"><input type="text" name="product_additionalfield[' + additionalfield_row + '][product_additionalfield_text][{{ language.language_id }}][title]" placeholder="{{ text_additionalfield_title }}" id="input-title' + additionalfield_row + '-language{{ language.language_id }}" value="" class="form-control"/></div>';
					html += '			</div>';
					html += '			<div class="form-group">';
					html += '				<label class="col-sm-2 control-label" for="input-text' + additionalfield_row + '-language{{ language.language_id }}">{{ entry_description }}</label>';
					html += '				<div class="col-sm-10"><input type="text" name="product_additionalfield[' + additionalfield_row + '][product_additionalfield_text][{{ language.language_id }}][text]" value="" id="input-text' + additionalfield_row + '-language{{ language.language_id }}" class="form-control"/></div>';
					html += '			</div>';
					html += '		</div>';
					{% endfor %}
					html += '	</div>';
					html += '		<div class="form-group">';
					html += '			<label class="col-sm-2 control-label" for="input-status' + additionalfield_row +'">{{ entry_status }}</label>';
					html += '			<div class="col-sm-10"><select name="product_additionalfield[' + additionalfield_row + '][status]" class="form-control"><option value="1">{{ text_enabled }}</option><option value="0">{{ text_disabled }}</option></select></div>';
					html += '		</div>';
					html += '	<div class="form-group">';
					html += '		<label class="col-sm-2 control-label" for="input-sort_order' + additionalfield_row +'">{{ entry_sort_order }}</label>';
					html += '		<div class="col-sm-10"><input type="text" name="product_additionalfield[' + additionalfield_row + '][sort_order]" value="" class="form-control" /></div>';
					html += '	</div>';
					html += '</div>';

					$('#tab-additionalfieldmain .tab-content2').append(html);

					{% for language in languages %}
					$('#input-text' + additionalfield_row + '-language{{ language.language_id }}');
					{% endfor %}

					$('#additionalfield a[href=\'#tab-additionalfield' + additionalfield_row + '\']').tab('show');

					$('#clanguage' + additionalfield_row + ' li:first-child a').tab('show');

					$('#additionalfield-add').before('<li><a href="#tab-additionalfield' + additionalfield_row + '" data-toggle="tab"><i class="fa fa-minus-circle" onclick="$(\'a[href=\\\'#tab-additionalfield' + additionalfield_row + '\\\']\').parent().remove(); $(\'#tab-additionalfield' + additionalfield_row + '\').remove(); $(\'#additionalfield li a:first\').tab(\'show\');"></i> {{ text_additionalfield }} ' + additionalfield_row + '</a></li>');


					$('#additionalfield-' + additionalfield_row).trigger('click');

					additionalfield_row++;
				}
				//--></script>

				<script type="text/javascript"><!--
				$('#additionalfield li:first-child a').tab('show');
				{% set additionalfield_row = 0 %}
				{% for product_additionalfield in product_additionalfields %}
				$('#clanguage{{ additionalfield_row }} li:first-child a').tab('show');
				{% set additionalfield_row = additionalfield_row + 1 %}
				{% endfor %}
				//--></script>
			{% endif %}
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/product/product.php">
		<operation error="log">
			<search><![CDATA[if ($product_info) {]]></search>
			<add position="after"><![CDATA[
			if ($this->config->get('module_additionalfields_status') == 1) {
				$data['additionalfields'] = array();

				$results = $this->model_catalog_product->getProductfields($this->request->get['product_id']);

				foreach ($results as $result) {
					$data['additionalfields'][] = array(
						'title'	=> $result['title'],
						'text'	=> $result['text'],
					);
				}
			} else {
				$data['additionalfields'] = false;
			}
			]]></add>
		</operation>
	</file>
	<file path="catalog/model/catalog/product.php">
		<operation error="log">
			<search><![CDATA[class ModelCatalogProduct extends Model {]]></search>
			<add position="after"><![CDATA[
			public function getProductfields($product_id) {
				$query = $this->db->query("SELECT * FROM " . DB_PREFIX . "product_additionalfield pc LEFT JOIN " . DB_PREFIX . "product_additionalfield_text pcd ON (pc.product_additionalfield_id = pcd.product_additionalfield_id) WHERE pc.product_id = '" . (int)$product_id . "' AND pcd.language_id = '" . (int)$this->config->get('config_language_id') . "' AND status > 0 ORDER BY sort_order ASC");

				return $query->rows;
			}
			]]></add>
		</operation>
	</file>
	<!-- Custom Tab https://www.opencart.com/index.php?route=marketplace/extension/info&extension_id=25379 -->
	<file path="admin/controller/catalog/product.php">
		<operation error="log">
			<search><![CDATA[protected function getForm() {]]></search>
			<add position="after"><![CDATA[
			if ($this->config->get('module_customtabs_status') == 1) {
				$data['module_customtabs'] = true;

				if (isset($this->request->post['product_customtab'])) {
					$data['product_customtabs'] = $this->request->post['product_customtab'];
				} elseif (isset($this->request->get['product_id'])) {
					$data['product_customtabs'] = $this->model_catalog_product->getProductcustomtabs($this->request->get['product_id']);
				} else {
					$data['product_customtabs'] = array();
				}
			} else {
				$data['module_customtabs'] = false;
			}
			]]></add>
		</operation>
	</file>
	<file path="admin/model/catalog/product.php">
		<operation error="log">
			<search><![CDATA[$product_id = $this->db->getLastId();]]></search>
			<add position="after"><![CDATA[
			if ($this->config->get('module_customtabs_status') == 1) {
				if (isset($data['product_customtab'])) {
					foreach ($data['product_customtab'] as $product_customtab) {
						$this->db->query("INSERT INTO " . DB_PREFIX . "product_customtab SET product_id = '" . (int)$product_id . "',  sort_order = '" . (int)$product_customtab['sort_order'] . "', status = '" . (int)$product_customtab['status'] . "'");

						$product_customtab_id = $this->db->getLastId();

						foreach ($product_customtab['product_customtab_description'] as $language_id => $product_customtab_description) {
							$this->db->query("INSERT INTO " . DB_PREFIX . "product_customtab_description SET product_customtab_id = '" . (int)$product_customtab_id . "', language_id = '" . (int)$language_id . "', product_id = '" . (int)$product_id . "', title = '" .  $this->db->escape($product_customtab_description['title']) . "', description = '" .  $this->db->escape($product_customtab_description['description']) . "'");
						}
					}
				}
			}
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[public function editProduct($product_id, $data) {]]></search>
			<add position="after"><![CDATA[
			if ($this->config->get('module_customtabs_status') == 1) {
				$this->db->query("DELETE FROM " . DB_PREFIX . "product_customtab WHERE product_id = '" . (int)$product_id . "'");
				$this->db->query("DELETE FROM " . DB_PREFIX . "product_customtab_description WHERE product_id = '" . (int)$product_id . "'");

				if (isset($data['product_customtab'])) {
					foreach ($data['product_customtab'] as $product_customtab) {
						$this->db->query("INSERT INTO " . DB_PREFIX . "product_customtab SET product_id = '" . (int)$product_id . "',  sort_order = '" . (int)$product_customtab['sort_order'] . "', status = '" . (int)$product_customtab['status'] . "'");

						$product_customtab_id = $this->db->getLastId();

						foreach ($product_customtab['product_customtab_description'] as $language_id => $product_customtab_description) {
							$this->db->query("INSERT INTO " . DB_PREFIX . "product_customtab_description SET product_customtab_id = '" . (int)$product_customtab_id . "', language_id = '" . (int)$language_id . "', product_id = '" . (int)$product_id . "', title = '" .  $this->db->escape($product_customtab_description['title']) . "', description = '" .  $this->db->escape($product_customtab_description['description']) . "'");
						}
					}
				}
			}
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[class ModelCatalogProduct extends Model {]]></search>
			<add position="after"><![CDATA[
			public function getProductcustomtabs($product_id) {
				$product_customtab_data = array();

				$product_customtab_query = $this->db->query("SELECT * FROM " . DB_PREFIX . "product_customtab WHERE product_id = '" . (int)$product_id . "' ORDER BY sort_order ASC");

					foreach ($product_customtab_query->rows as $product_customtab) {
						$product_customtab_description_data = array();
						$product_customtab_description_query = $this->db->query("SELECT * FROM " . DB_PREFIX . "product_customtab_description WHERE product_customtab_id = '" . (int)$product_customtab['product_customtab_id'] . "' AND product_id = '" . (int)$product_id . "'");

						foreach ($product_customtab_description_query->rows as $product_customtab_description) {
							$product_customtab_description_data[$product_customtab_description['language_id']] = array(
								'title' => $product_customtab_description['title'],
								'description' => $product_customtab_description['description'],
							);
						}

						$product_customtab_data[] = array(
							'product_customtab_description'	=> $product_customtab_description_data,
							'status'						=> $product_customtab['status'],
							'sort_order'					=> $product_customtab['sort_order']
						);
					}

				return $product_customtab_data;
			}
			]]></add>
		</operation>
	</file>
	<file path="admin/view/template/catalog/product_form.twig">
		<operation error="log">
			<search><![CDATA[<li><a href="#tab-design" data-toggle="tab">{{ tab_design }}</a></li>]]></search>
			<add position="after"><![CDATA[
			{% if module_customtabs %}
				<li><a href="#tab-customtabmain" data-toggle="tab">{{ text_customtab }}</a></li>
			{% endif %}
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[<div class="tab-pane" id="tab-design">]]></search>
			<add position="before"><![CDATA[
			{% if module_customtabs %}
				<div class="tab-pane" id="tab-customtabmain">
					<div class="col-sm-2">
						<ul class="nav nav-pills nav-stacked" id="customtab">
							{% set customtab_row = 0 %}
							{% for product_customtab in product_customtabs %}
							<li><a href="#tab-customtab{{ customtab_row }}" data-toggle="tab"><i class="fa fa-minus-circle" onclick="$('a[href=\'#tab-customtab{{ customtab_row }}\']').parent().remove(); $('#tab-customtab{{ customtab_row }}').remove(); $('#customtab a:first').tab('show');"></i> {{ text_customtab }} {{ customtab_row }}</a></li>
							{% set customtab_row = customtab_row + 1 %}
							{% endfor %}
							<li id="customtab-add"><a onclick="addCustomtab();"><i class="fa fa-plus-circle"></i> {{ text_add_tab }}</a></li>
						</ul>
					</div>
					<div class="col-sm-10">
						<div class="tab-content tab-content2">
							{% set customtab_row = 0 %}
							{% for product_customtab in product_customtabs %}
							<div class="tab-pane" id="tab-customtab{{ customtab_row }}">
								<ul class="nav nav-tabs" id="clanguage{{ customtab_row }}">
									{% for language in languages %}
									<li><a href="#tab-customtab{{customtab_row }}-language{{ language.language_id }}" data-toggle="tab"><img src="language/{{ language.code }}/{{ language.code }}.png" title="{{ language.name }}" />  {{ language.name }}</a></li>
									{% endfor %}
								</ul>
								<div class="tab-content">
									{% for language in languages %}
										<div class="tab-pane" id="tab-customtab{{customtab_row }}-language{{ language.language_id }}">
											<div class="form-group">
												<label class="col-sm-2 control-label" for="input-heading{{customtab_row }}-language{{ language.language_id }}">{{ text_tab_title }}</label>
												<div class="col-sm-10">
													<input type="text" name="product_customtab[{{customtab_row }}][product_customtab_description][{{ language.language_id }}][title]" placeholder="{{ text_tab_title }}" value="{{ product_customtab.product_customtab_description[language.language_id] ? product_customtab.product_customtab_description[language.language_id].title }}" class="form-control"/>
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-2 control-label" for="input-description{{customtab_row }}-language{{ language.language_id }}">{{ entry_description }}</label>
												<div class="col-sm-10">
													<textarea name="product_customtab[{{customtab_row }}][product_customtab_description][{{ language.language_id }}][description]" placeholder="{{ entry_description }}" id="input-description{{customtab_row }}-language{{ language.language_id }}" class="form-control">{{ product_customtab.product_customtab_description[language.language_id] ? product_customtab.product_customtab_description[language.language_id].description }}</textarea>
												</div>
											</div>
										</div>
									{% endfor %}
								</div>
								<div class="form-group">
									<label class="col-sm-2 control-label" for="input-sort_order{{ customtab_row }}">{{ entry_sort_order }}</label>
									<div class="col-sm-10">
										<input type="text" name="product_customtab[{{ customtab_row }}][sort_order]" value="{{ product_customtab.sort_order }}" placeholder="{{ entry_sort_order }}" class="form-control" />
									</div>
								</div>
								<div class="form-group">
									<label class="col-sm-2 control-label" for="input-status{{ customtab_row }}">{{ entry_status }}</label>
									<div class="col-sm-10">
										<select name="product_customtab[{{ customtab_row }}][status]" id="input-status" class="form-control">
											{% if product_customtab.status %}
											<option value="1" selected="selected">{{ text_enabled }}</option>
											<option value="0">{{ text_disabled }}</option>
											{% else %}
											<option value="1">{{ text_enabled }}</option>
											<option value="0" selected="selected">{{ text_disabled }}</option>
											{% endif %}
										</select>
									</div>
								</div>
							</div>
							{% set customtab_row = customtab_row + 1 %}
							{% endfor %}
						</div>
					</div>
				</div>
			{% endif %}
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[{{ footer }}]]></search>
			<add position="before"><![CDATA[
			{% if module_customtabs %}
				<script type="text/javascript"><!--
				{% set customtab_row = 0 %}
				{% for product_customtab in product_customtabs %}
				{% for language in languages %}
				$('#input-description{{ customtab_row }}-language{{ language.language_id }}').summernote({
					height: 300
				});
				{% endfor %}
				{% set customtab_row = customtab_row + 1 %}
				{% endfor %}
				//--></script>

				<script type="text/javascript"><!--
				var customtab_row = {{ customtab_row }};

				function addCustomtab() {
					html  = '<div id="tab-customtab' + customtab_row + '" class="tab-pane">';
					html += '	<ul class="nav nav-tabs" id="clanguage' + customtab_row + '">';
					{% for language in languages %}
					html += '		<li><a href="#tab-customtab' + customtab_row + '-language{{ language.language_id }}" data-toggle="tab"><img src="language/{{ language.code }}/{{ language.code }}.png" title="{{ language.name }}" /> {{ language.name }}</a></li>';
					{% endfor %}
					html += '	</ul>';

					html += '	<div class="tab-content">';
					{% for language in languages %}
					html += '		<div class="tab-pane" id="tab-customtab' + customtab_row + '-language{{ language.language_id }}">';
					html += '			<div class="form-group">';
					html += '				<label class="col-sm-2 control-label" for="input-title' + customtab_row + '-language{{ language.language_id }}">{{ text_tab_title }}</label>';
					html += '				<div class="col-sm-10"><input type="text" name="product_customtab[' + customtab_row + '][product_customtab_description][{{ language.language_id }}][title]" placeholder="{{ text_tab_title }}" id="input-title' + customtab_row + '-language{{ language.language_id }}" value="" class="form-control"/></div>';
					html += '			</div>';
					html += '			<div class="form-group">';
					html += '				<label class="col-sm-2 control-label" for="input-description' + customtab_row + '-language{{ language.language_id }}">{{ entry_description }}</label>';
					html += '				<div class="col-sm-10"><textarea name="product_customtab[' + customtab_row + '][product_customtab_description][{{ language.language_id }}][description]" id="input-description' + customtab_row + '-language{{ language.language_id }}"></textarea></div>';
					html += '			</div>';
					html += '		</div>';
					{% endfor %}
					html += '	</div>';
					html += '		<div class="form-group">';
					html += '			<label class="col-sm-2 control-label" for="input-status' + customtab_row +'">{{ entry_status }}</label>';
					html += '			<div class="col-sm-10"><select name="product_customtab[' + customtab_row + '][status]" class="form-control"><option value="1">{{ text_enabled }}</option><option value="0">{{ text_disabled }}</option></select></div>';
					html += '		</div>';
					html += '	<div class="form-group">';
					html += '		<label class="col-sm-2 control-label" for="input-sort_order' + customtab_row +'">{{ entry_sort_order }}</label>';
					html += '		<div class="col-sm-10"><input type="text" name="product_customtab[' + customtab_row + '][sort_order]" value="" class="form-control" /></div>';
					html += '	</div>';
					html += '</div>';

					$('#tab-customtabmain .tab-content2').append(html);

					{% for language in languages %}
					$('#input-description' + customtab_row + '-language{{ language.language_id }}').summernote({
						height: 300
					});
					{% endfor %}

					$('#customtab a[href=\'#tab-customtab' + customtab_row + '\']').tab('show');

					$('#clanguage' + customtab_row + ' li:first-child a').tab('show');

					$('#customtab-add').before('<li><a href="#tab-customtab' + customtab_row + '" data-toggle="tab"><i class="fa fa-minus-circle" onclick="$(\'a[href=\\\'#tab-customtab' + customtab_row + '\\\']\').parent().remove(); $(\'#tab-customtab' + customtab_row + '\').remove(); $(\'#customtab li a:first\').tab(\'show\');"></i> {{ text_customtab }} ' + customtab_row + '</a></li>');


					$('#customtab-' + customtab_row).trigger('click');

					customtab_row++;
				}
				//--></script>

				<script type="text/javascript"><!--
				$('#customtab li:first-child a').tab('show');
				{% set customtab_row = 0 %}
				{% for product_customtab in product_customtabs %}
				$('#clanguage{{ customtab_row }} li:first-child a').tab('show');
				{% set customtab_row = customtab_row + 1 %}
				{% endfor %}
				//--></script>
			{% endif %}
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/product/product.php">
		<operation error="log">
			<search><![CDATA[if ($product_info) {]]></search>
			<add position="after"><![CDATA[
			if ($this->config->get('module_customtabs_status') == 1) {
				$data['customtabs'] = array();

				$results = $this->model_catalog_product->getProducttabs($this->request->get['product_id']);

				foreach ($results as $result) {
					$data['customtabs'][] = array(
						'title'			=> $result['title'],
						'description'	=> html_entity_decode($result['description'], ENT_QUOTES, 'UTF-8'),
					);
				}
			} else {
				$data['customtabs'] = false;
			}
			]]></add>
		</operation>
	</file>
	<file path="catalog/model/catalog/product.php">
		<operation error="log">
			<search><![CDATA[class ModelCatalogProduct extends Model {]]></search>
			<add position="after"><![CDATA[
			public function getProducttabs($product_id) {
				$query = $this->db->query("SELECT * FROM " . DB_PREFIX . "product_customtab pc LEFT JOIN " . DB_PREFIX . "product_customtab_description pcd ON (pc.product_customtab_id  = pcd.product_customtab_id) WHERE pc.product_id = '" . (int)$product_id . "'  AND pcd.language_id = '" . (int)$this->config->get('config_language_id') . "' AND status > 0 ORDER BY sort_order ASC");

				return $query->rows;
			}
			]]></add>
		</operation>
	</file>
	<!-- Apply button -->
	<file path="admin/controller/catalog/product.php">
		<operation error="log">
			<search><![CDATA[public function autocomplete()]]></search>
			<add position="before"><![CDATA[
			public function apply() {
				$this->load->language('catalog/product');

				$this->document->setTitle($this->language->get('heading_title'));

				$this->load->model('catalog/product');

				if (($this->request->server['REQUEST_METHOD'] == 'POST') && $this->validateForm()) {
					$this->model_catalog_product->editProduct($this->request->get['product_id'], $this->request->post);

					$this->session->data['success'] = $this->language->get('text_success');

					$url = '';

				if (isset($this->request->get['product_id'])) {
					$url .= '&product_id=' . $this->request->get['product_id'];
				}
					$this->response->redirect($this->url->link('catalog/product/edit', 'user_token=' . $this->session->data['user_token'] . $url, true));
				}

				$this->getForm();
			}
			]]></add>
		</operation>
		<operation error="log">
			<search index="0"><![CDATA[$data['action']]]></search>
			<add position="after"><![CDATA[$data['apply'] = $this->url->link('catalog/product/add', 'user_token=' . $this->session->data['user_token'] . $url, true);]]></add>
		</operation>
		<operation error="log">
			<search index="1"><![CDATA[$data['action']]]></search>
			<add position="after"><![CDATA[$data['apply'] = $this->url->link('catalog/product/apply', 'user_token=' . $this->session->data['user_token'] . '&product_id=' . $this->request->get['product_id'] . $url, true);]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$data['footer'] = $this->load->controller('common/footer');]]></search>
			<add position="after"><![CDATA[
			if (isset($this->session->data['success'])) {
				$data['success'] = $this->session->data['success'];
				unset($this->session->data['success']);
			} else {
				$data['success'] = '';
			}
			]]></add>
		</operation>
	</file>
	<file path="admin/view/template/catalog/product_form.twig">
		<operation error="log">
			<search><![CDATA[<div class="panel panel-default">]]></search>
			<add position="before"><![CDATA[
			{% if success %}
			<div class="alert alert-success"><i class="fa fa-check-circle"></i> {{ success }}
				<button type="button" class="close" data-dismiss="alert">&times;</button>
			</div>
			{% endif %}
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[<form action="{{ action }}" method="post" enctype="multipart/form-data" id="form-product" class="form-horizontal">]]></search>
			<add position="replace"><![CDATA[<form action="{{ action }}" data-action="{{ apply|raw }}" method="post" enctype="multipart/form-data" id="form-product" class="form-horizontal">]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[<ul class="nav nav-tabs">]]></search>
			<add position="replace"><![CDATA[<ul class="nav nav-tabs" id="apply-tab">]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[<div class="pull-right">]]></search>
			<add position="after"><![CDATA[<button type="button" form="form-product" id="apply-btn" data-toggle="tooltip" title="{{ text_apply }}" class="btn btn-success"><i class="fa fa-repeat"></i></button>]]>
			</add>
		</operation>
		<operation error="log">
			<search><![CDATA[{{ footer }}]]></search>
			<add position="before"><![CDATA[
			<script type="text/javascript">
				var applyBtn = $('#apply-btn'),
					formProduct = $('#form-product'),
					dataAction = formProduct.attr('data-action');

				if (sessionStorage['index_p']) {
					var index_p = sessionStorage['index_p'];
				} else {
					var index_p = 0;
				}

				$('#apply-tab li:eq(' + index_p + ') a').tab('show');
				sessionStorage['index_p'] = 0;

				applyBtn.click(function() {
					sessionStorage['index_p'] = $(".nav-tabs .active").index();

					formProduct.attr({'action':dataAction});
					formProduct.submit();

					e.preventDefault();
				});

				document.addEventListener("keydown", function(event) {
					if (event.keyCode == 83 && (navigator.platform.match("Mac") ? event.metaKey : event.ctrlKey)) {
						event.preventDefault();
						applyBtn.trigger('click');
					}
				}, false);
			</script>
			]]></add>
		</operation>
	</file>
	<file path="admin/controller/catalog/category.php">
		<operation error="log">
			<search><![CDATA[public function autocomplete()]]></search>
			<add position="before"><![CDATA[
			public function apply() {
				$this->load->language('catalog/category');

				$this->document->setTitle($this->language->get('heading_title'));

				$this->load->model('catalog/category');

				if (($this->request->server['REQUEST_METHOD'] == 'POST') && $this->validateForm()) {
					$this->model_catalog_category->editCategory($this->request->get['category_id'], $this->request->post);

					$this->session->data['success'] = $this->language->get('text_success');

					$url = '';

				if (isset($this->request->get['category_id'])) {
					$url .= '&category_id=' . $this->request->get['category_id'];
				}
					$this->response->redirect($this->url->link('catalog/category/edit', 'user_token=' . $this->session->data['user_token'] . $url, true));
				}

				$this->getForm();
			}
			]]></add>
		</operation>
		<operation error="log">
			<search index="0"><![CDATA[$data['action']]]></search>
			<add position="after"><![CDATA[$data['apply'] = $this->url->link('catalog/category/add', 'user_token=' . $this->session->data['user_token'] . $url, true);]]></add>
		</operation>
		<operation error="log">
			<search index="1"><![CDATA[$data['action']]]></search>
			<add position="after"><![CDATA[$data['apply'] = $this->url->link('catalog/category/apply', 'user_token=' . $this->session->data['user_token'] . '&category_id=' . $this->request->get['category_id'] . $url, true);]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$data['footer'] = $this->load->controller('common/footer');]]></search>
			<add position="after"><![CDATA[
			if (isset($this->session->data['success'])) {
				$data['success'] = $this->session->data['success'];
				unset($this->session->data['success']);
			} else {
				$data['success'] = '';
			}
			]]></add>
		</operation>
	</file>
	<file path="admin/view/template/catalog/category_form.twig">
		<operation error="log">
			<search><![CDATA[<div class="panel panel-default">]]></search>
			<add position="before"><![CDATA[
			{% if success %}
			<div class="alert alert-success"><i class="fa fa-check-circle"></i> {{ success }}
				<button type="button" class="close" data-dismiss="alert">&times;</button>
			</div>
			{% endif %}
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[<form action="{{ action }}" method="post" enctype="multipart/form-data" id="form-category" class="form-horizontal">]]></search>
			<add position="replace"><![CDATA[<form action="{{ action }}" data-action="{{ apply|raw }}" method="post" enctype="multipart/form-data" id="form-category" class="form-horizontal">]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[<ul class="nav nav-tabs">]]></search>
			<add position="replace"><![CDATA[<ul class="nav nav-tabs" id="apply-tab">]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[<div class="pull-right">]]></search>
			<add position="after"><![CDATA[<button type="button" form="form-category" id="apply-btn" data-toggle="tooltip" title="{{ text_apply }}" class="btn btn-success"><i class="fa fa-repeat"></i></button>]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[{{ footer }]]></search>
			<add position="before"><![CDATA[
			<script type="text/javascript">
				var applyBtn = $('#apply-btn'),
					formProduct = $('#form-category'),
					dataAction = formProduct.attr('data-action');

				if (sessionStorage['index_p']) {
					var index_p = sessionStorage['index_p'];
				} else {
					var index_p = 0;
				}

				$('#apply-tab li:eq(' + index_p + ') a').tab('show');
				sessionStorage['index_p'] = 0;

				applyBtn.click(function() {
					sessionStorage['index_p'] = $(".nav-tabs .active").index();

					formProduct.attr({'action':dataAction});
					formProduct.submit();

					e.preventDefault();
				});

				document.addEventListener("keydown", function(event) {
					if (event.keyCode == 83 && (navigator.platform.match("Mac") ? event.metaKey : event.ctrlKey)) {
						event.preventDefault();
						applyBtn.trigger('click');
					}
				}, false);
			</script>
			]]></add>
		</operation>
	</file>
	<!-- Languages settings -->
	<file path="catalog/controller/common/cart.php">
		<operation error="log">
			<search><![CDATA[$data['text_items'] = sprintf($this->language->get('text_items'), $this->cart->countProducts() + (isset($this->session->data['vouchers']) ? count($this->session->data['vouchers']) : 0), $this->currency->format($total, $this->session->data['currency']));]]></search>
			<add position="replace"><![CDATA[$data['text_items'] = sprintf($this->cart->countProducts() + (isset($this->session->data['vouchers']) ? count($this->session->data['vouchers']) : 0));]]></add>
		</operation>
	</file>
	<file path="catalog/controller/checkout/cart.php">
		<operation error="log">
			<search><![CDATA[$json['total'] = sprintf($this->language->get('text_items'), $this->cart->countProducts() + (isset($this->session->data['vouchers']) ? count($this->session->data['vouchers']) : 0), $this->currency->format($total, $this->session->data['currency']));]]></search>
			<add position="replace"><![CDATA[$json['total'] = sprintf($this->cart->countProducts() + (isset($this->session->data['vouchers']) ? count($this->session->data['vouchers']) : 0));]]></add>
		</operation>
	</file>
	<file path="catalog/controller/product/compare.php">
		<operation error="log">
			<search><![CDATA[$json['total'] = sprintf($this->language->get('text_compare'), (isset($this->session->data['compare']) ? count($this->session->data['compare']) : 0));]]></search>
			<add position="replace"><![CDATA[$json['total'] = (isset($this->session->data['compare']) ? count($this->session->data['compare']) : 0);]]></add>
		</operation>
	</file>
	<file path="admin/controller/{catalog,common}/{product,category,column_left}*.php">
		<operation error="log">
			<search><![CDATA[public function index() {]]></search>
			<add position="after"><![CDATA[$this->load->language('materialize/materialize');]]></add>
		</operation>
	</file>
	<file path="catalog/controller/common/{cart,header}*.php">
		<operation error="log">
			<search><![CDATA[public function index() {]]></search>
			<add position="after"><![CDATA[$this->load->language('common/materialize');]]></add>
		</operation>
	</file>
	<file path="catalog/controller/information/contact.php">
		<operation error="log">
			<search><![CDATA[public function index() {]]></search>
			<add position="after"><![CDATA[$this->load->language('information/materialize');]]></add>
		</operation>
	</file>
	<file path="catalog/controller/{information,checkout,affiliate,account}/{contact,checkout,guest,register,login,payment_address,shipping_address,edit}*.php">
		<operation error="log">
			<search><![CDATA[public function index() {]]></search>
			<add position="after"><![CDATA[$this->load->language('materialize/materialize');]]></add>
		</operation>
	</file>
	<file path="catalog/controller/account/address.php">
		<operation error="log">
			<search><![CDATA[protected function getForm() {]]></search>
			<add position="after"><![CDATA[$this->load->language('materialize/materialize');]]></add>
		</operation>
	</file>
	<file path="catalog/controller/account/affiliate.php">
		<operation error="log">
			<search><![CDATA[public function getForm() {]]></search>
			<add position="after"><![CDATA[$this->load->language('materialize/materialize');]]></add>
		</operation>
	</file>
	<file path="catalog/controller/product/{category,manufacturer,product,search,special}*.php">
		<operation error="log">
			<search><![CDATA[public function index() {]]></search>
			<add position="after"><![CDATA[
			$this->load->language('product/materialize');
			$this->load->language('materialize/materialize');
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/product/manufacturer.php">
		<operation error="log">
			<search><![CDATA[public function info() {]]></search>
			<add position="after"><![CDATA[$this->load->language('product/materialize');]]></add>
		</operation>
	</file>
	<file path="catalog/controller/extension/module/{bestseller,latest,featured,special}*.php">
		<operation error="log">
			<search><![CDATA[public function index($setting) {]]></search>
			<add position="after"><![CDATA[$this->load->language('product/materialize');]]></add>
		</operation>
	</file>
	<file path="catalog/language/{en-gb,ro-ro,ru-ru,tr-tr,ua-uk,bg-bg}/{en-gb,ro-ro,ru-ru,tr-tr,ua-uk,bg-bg}*.php">
		<operation error="skip">
			<search><![CDATA[<?php]]></search>
			<add position="after"><![CDATA[$_['img_loader'] = 'data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==';]]></add>
		</operation>
	</file>
	<file path="catalog/language/{en-gb,ro-ro,ru-ru,tr-tr,ua-uk,bg-bg}/{en-gb,ro-ro,ru-ru,tr-tr,ua-uk,bg-bg}*.php">
		<operation error="skip">
			<search><![CDATA[<i class="fa fa-home"></i>]]></search>
			<add position="replace"><![CDATA[<i class="material-icons">home</i>]]></add>
		</operation>
	</file>
	<file path="catalog/language/{en-gb,ro-ro,ru-ru,tr-tr,ua-uk,bg-bg}/common/footer.php">
		<operation error="skip">
			<search><![CDATA[<a target="_blank" href="]]></search>
			<add position="replace"><![CDATA[<a target="_blank" rel="noopener" href="]]></add>
		</operation>
	</file>
	<!-- Register a template installation -->
	<file path="catalog/controller/common/{cart,footer,header,menu,search}*.php">
		<operation error="log">
			<search><![CDATA[public function index() {]]></search>
			<add position="after"><![CDATA[
			if ($this->config->get('theme_materialize_status') == 1) {
				$materialize = true;

				$materialize_settings = $this->config->get('theme_materialize_settings');
			} else {
				$materialize = false;
			}
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/product/{category,compare,product,search,special}*.php">
		<operation error="log">
			<search><![CDATA[public function index() {]]></search>
			<add position="after"><![CDATA[
			if ($this->config->get('theme_materialize_status') == 1) {
				$materialize = true;

				$materialize_settings = $this->config->get('theme_materialize_settings');
			} else {
				$materialize = false;
			}
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/product/manufacturer.php">
		<operation error="log">
			<search><![CDATA[public function info() {]]></search>
			<add position="after"><![CDATA[
			if ($this->config->get('theme_materialize_status') == 1) {
				$materialize = true;

				$materialize_settings = $this->config->get('theme_materialize_settings');
			} else {
				$materialize = false;
			}
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/extension/module/{bestseller,featured,latest,special}*.php">
		<operation error="log">
			<search><![CDATA[public function index($setting) {]]></search>
			<add position="after"><![CDATA[
			if ($this->config->get('theme_materialize_status') == 1) {
				$materialize = true;

				$materialize_settings = $this->config->get('theme_materialize_settings');
			} else {
				$materialize = false;
			}
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/extension/module/{banner,carousel,slideshow}*.php">
		<operation error="log">
			<search><![CDATA[public function index($setting) {]]></search>
			<add position="after"><![CDATA[
			if ($this->config->get('theme_materialize_status') == 1) {
				$materialize = true;

				$materialize_settings = $this->config->get('theme_materialize_settings');
			} else {
				$materialize = false;
			}
			]]></add>
		</operation>
	</file>
</modification>
